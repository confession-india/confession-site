<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LT5SF025XK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-LT5SF025XK');
    </script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="E0eroPpuSrFX_H8NK5GV0vtHNz5S-xScaEDuM25Zth4" />

    <title>Confess India | Share Your Truth Anonymously</title>
    
    <meta name="description" content="Confess India: The safest digital sanctuary to share secrets. ‡∞≠‡∞æ‡∞∞‡∞§‡±Ä‡∞Ø‡±Å‡∞≤ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞Ö‡∞ú‡±ç‡∞û‡∞æ‡∞§ ‡∞∞‡∞π‡∞∏‡±ç‡∞Ø‡∞æ‡∞≤ ‡∞µ‡±á‡∞¶‡∞ø‡∞ï. ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ó‡•Å‡§™‡•ç‡§§ ‡§∞‡§π‡§∏‡•ç‡§Ø ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§Æ‡§Ç‡§ö‡•§">
    <meta name="keywords" content="anonymous confessions india, share secrets online, telugu confessions, hindi confessions, hyderabad secrets, london confessions">
    <link rel="canonical" href="https://confessionindia.in/" />
    
    <meta property="og:title" content="Confess India | Anonymous Truths">
    <meta property="og:description" content="Share your deepest secrets safely and anonymously. No accounts. No tracking.">
    <meta property="og:image" content="https://confessionindia.in/og-image.png">
    <meta property="og:url" content="https://confessionindia.in">
    <meta name="theme-color" content="#0f172a">
    
    <link rel="icon" href="https://fav.farm/ü§´">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <link rel="stylesheet" href="style.css">

    <script>
        // Theme & Language Initialization
        // We check local storage or system preferences to set Dark Mode immediately
        if (localStorage.getItem('userLang') === null) { 
            localStorage.setItem('userLang', 'en'); 
        }
        
        if (localStorage.getItem('theme') === 'dark' || 
            (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
</head>

<body class="bg-[#fdfdff] dark:bg-[#0b1120] min-h-screen font-sans transition-colors duration-300">

    <div class="sticky top-0 z-[100] bg-slate-900 py-3 overflow-x-auto no-scrollbar border-b border-slate-800">
        <div class="max-w-4xl mx-auto px-4 flex gap-2">
            <button onclick="setLanguage('en')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-en">
                English
            </button>
            <button onclick="setLanguage('te')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-te">
                ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å
            </button>
            <button onclick="setLanguage('hi')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-hi">
                ‡§π‡§ø‡§Ç‡§¶‡•Ä
            </button>
            <button onclick="setLanguage('ta')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-ta">
                ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç
            </button>
            <button onclick="setLanguage('kn')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-kn">
                ‡≤ï‡≤®‡≥ç‡≤®‡≤°
            </button>
            <button onclick="setLanguage('ml')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-ml">
                ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç
            </button>
        </div>
    </div>

    <header class="sticky top-[52px] z-[90] bg-white/80 dark:bg-[#0b1120]/80 backdrop-blur-xl border-b border-gray-100 dark:border-red-900/30">
        <div class="max-w-4xl mx-auto p-4 flex justify-between items-center">
            <div class="flex flex-col">
                <a href="index.html" class="hover:opacity-80 transition-opacity">
                    <h1 class="text-2xl font-black bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent leading-none">
                        Confess India
                    </h1>
                </a>
                <span id="ui-subheading" class="text-[10px] text-gray-400 dark:text-slate-500 font-bold tracking-widest uppercase mt-1 ml-0.5">
                    Community Feed
                </span>
            </div>
            
            <a href="post.html" id="ui-share-btn" class="bg-indigo-600 text-white px-5 py-2.5 rounded-2xl shadow-lg font-bold text-sm transition-all hover:bg-indigo-700 hover:scale-105 active:scale-95">
                + Share Secret
            </a>
        </div>
    </header>

    <div class="page-wrapper">
        
        <button id="scrollTab" onclick="handleScrollAction()" class="fixed bottom-8 right-8 z-[110] bg-indigo-600 text-white p-4 rounded-2xl shadow-2xl flex items-center justify-center hover:bg-indigo-700 active:scale-90 transition-all hidden">
            <svg id="scrollIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
            </svg>
        </button>

        <main class="max-w-4xl mx-auto p-4">
            
            <div id="dailyWisdom" class="mb-2 hidden">
                <div class="bg-indigo-600 rounded-[32px] p-6 text-white shadow-xl flex flex-col md:flex-row items-center gap-6 border-4 border-indigo-500/30">
                    <div class="bg-white/20 p-4 rounded-2xl text-2xl">üî•</div>
                    <div class="flex-1 text-center md:text-left overflow-hidden">
                        <h3 class="text-[10px] font-black uppercase tracking-widest opacity-80 mb-1">Most Supported Today</h3>
                        <p id="top-secret-text" class="text-lg font-bold leading-tight italic break-words">"Loading truth..."</p>
                    </div>
                </div>
            </div>

            <div class="flex overflow-x-auto py-6 space-x-3 no-scrollbar items-center">
                <button onclick="filterCat('all', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 transition-all text-sm cat-active" id="cat-all">Latest</button>
                <button onclick="filterCat('relationship', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 transition-all text-sm" id="cat-rel">Relationships</button>
                <button onclick="filterCat('family', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 transition-all text-sm" id="cat-fam">Family</button>
                <button onclick="filterCat('marriage', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 transition-all text-sm" id="cat-mar">Marriage</button>
                <button onclick="filterCat('other', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 transition-all text-sm" id="cat-oth">Other</button>
            </div>

            <div id="feed" class="grid grid-cols-1 gap-6 mt-2 min-h-[500px]">
                <div class="animate-pulse bg-slate-100 dark:bg-slate-800/50 h-64 rounded-[32px]"></div>
                <div class="animate-pulse bg-slate-100 dark:bg-slate-800/50 h-64 rounded-[32px]"></div>
            </div>

            <section class="mt-20 py-12 border-t border-slate-100 dark:border-slate-800">
                <div class="text-center mb-10">
                    <span class="text-[10px] font-black text-indigo-600 uppercase tracking-[0.3em]">Privacy First</span>
                    <h2 class="text-2xl font-black text-slate-800 dark:text-white mt-2">Your Identity is Protected</h2>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white dark:bg-slate-800/50 p-6 rounded-3xl border border-slate-50 dark:border-slate-800 shadow-sm">
                        <div class="w-10 h-10 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-xl flex items-center justify-center mb-4 text-xl">üõ°Ô∏è</div>
                        <h4 class="font-bold text-slate-800 dark:text-white mb-2">Zero Logs</h4>
                        <p class="text-sm text-slate-500 dark:text-slate-400 leading-relaxed">
                            We don't store IP addresses or tracking cookies. Your secrets stay yours and cannot be traced back.
                        </p>
                    </div>
                    <div class="bg-white dark:bg-slate-800/50 p-6 rounded-3xl border border-slate-50 dark:border-slate-800 shadow-sm">
                        <div class="w-10 h-10 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-xl flex items-center justify-center mb-4 text-xl">üëª</div>
                        <h4 class="font-bold text-slate-800 dark:text-white mb-2">No Accounts</h4>
                        <p class="text-sm text-slate-500 dark:text-slate-400 leading-relaxed">
                            No emails. No passwords. No data leaks. Complete anonymity by design for every Indian citizen.
                        </p>
                    </div>
                    <div class="bg-white dark:bg-slate-800/50 p-6 rounded-3xl border border-slate-50 dark:border-slate-800 shadow-sm">
                        <div class="w-10 h-10 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-xl flex items-center justify-center mb-4 text-xl">üëÄ</div>
                        <h4 class="font-bold text-slate-800 dark:text-white mb-2">Human Moderated</h4>
                        <p class="text-sm text-slate-500 dark:text-slate-400 leading-relaxed">
                            Every report is checked by a human moderator to keep the community safe and free of hate speech.
                        </p>
                    </div>
                </div>
            </section>
        </main>

        <div id="shareModal" class="fixed inset-0 bg-slate-900/95 backdrop-blur-xl hidden items-center justify-center z-[10000] p-4" onclick="closeShare()">
            <div class="bg-white dark:bg-slate-800 p-8 rounded-[40px] w-full max-w-sm space-y-3 shadow-2xl" onclick="event.stopPropagation()">
                <h3 class="font-black text-xl text-center mb-6 dark:text-white italic">Share This Truth</h3>
                
                <div class="grid grid-cols-1 gap-3">
                    <button id="igBtn" class="flex items-center justify-center gap-3 bg-gradient-to-tr from-[#f9ce34] via-[#ee2a7b] to-[#6228d7] text-white py-4 rounded-2xl font-bold active:scale-95 transition-all shadow-lg">
                        <span>Instagram Card + QR</span>
                    </button>
                    
                    <button id="waBtn" class="bg-[#25D366] text-white py-4 rounded-2xl font-bold active:scale-95 transition-all flex items-center justify-center gap-2">
                        WhatsApp
                    </button>
                    
                    <button id="copyTxtBtn" class="bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 py-4 rounded-2xl font-bold">
                        Copy Message Text
                    </button>
                    
                    <button id="copyBtn" class="bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400 py-4 rounded-2xl font-bold">
                        Copy Web Link
                    </button>
                </div>
                
                <button onclick="closeShare()" class="w-full text-slate-400 font-bold py-2 mt-4 uppercase text-[10px] tracking-[0.2em] hover:text-indigo-500">
                    Cancel / Close
                </button>
            </div>
        </div>

        <footer id="mainFooter" class="bg-[#0f172a] text-slate-400 pt-16 pb-8 px-4 mt-10 relative z-10 border-t border-slate-800">
            <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-12 text-center md:text-left">
                
                <div class="space-y-4">
                    <h2 class="text-white text-xl font-black italic tracking-tighter">
                        Confess<span class="text-indigo-400">India</span>
                    </h2>
                    <p class="text-sm leading-relaxed">
                        The safest digital space for Indians to share their deepest truths without fear of judgment.
                    </p>
                </div>

                <div>
                    <h3 class="text-white text-xs font-black uppercase tracking-[0.2em] mb-6">Resources</h3>
                    <ul class="space-y-3 text-sm font-bold">
                        <li><a href="legal.html#privacy" class="hover:text-white transition-colors">Privacy Policy</a></li>
                        <li><a href="legal.html#rules" class="hover:text-white transition-colors">Community Guidelines</a></li>
                        <li><a href="post.html" class="hover:text-white transition-colors">Submit Secret</a></li>
                    </ul>
                </div>

                <div class="space-y-4">
                    <h3 class="text-white text-xs font-black uppercase tracking-[0.2em] mb-2">Connection</h3>
                    <div class="flex flex-col gap-2 text-slate-500 text-[10px] uppercase font-black tracking-widest">
                        <span>üìç HYD: <span id="hyd-time" class="text-indigo-400">--:--</span></span>
                        <span>üá¨üáß LDN: <span id="ldn-time" class="text-indigo-400">--:--</span></span>
                    </div>
                    <p class="text-[10px] text-slate-600 font-medium mt-4">
                        ¬© 2026 Confess India. Built between Hyderabad & London.
                    </p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // --- 1. FIREBASE INITIALIZATION ---
        const firebaseConfig = { 
            apiKey: "AIzaSyA8JIiJ5sRc5Fxy6qcYAXD8_nA8ELOBwkI", 
            authDomain: "confession-india.firebaseapp.com", 
            projectId: "confession-india", 
            storageBucket: "confession-india.firebasestorage.app", 
            messagingSenderId: "345080016810", 
            appId: "1:345080016810:web:3032f570077ea8d6dd45d3" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const SITE_URL = "https://confessionindia.in";
        
        // UI Translations
        const translations = {
            en: { shareTruth: "Share Truth", readMore: "Read More", readLess: "Read Less", report: "Report" },
            te: { shareTruth: "‡∞∑‡±á‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø", readMore: "‡∞Æ‡∞∞‡∞ø‡∞Ç‡∞§ ‡∞ö‡∞¶‡∞µ‡∞Ç‡∞°‡∞ø", readLess: "‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ", report: "‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡±ç" },
            hi: { shareTruth: "‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç", readMore: "‡§î‡§∞ ‡§™‡§¢‡§º‡•á‡§Ç", readLess: "‡§ï‡§Æ", report: "‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü" },
            ta: { shareTruth: "‡Æ™‡Æï‡Æø‡Æ∞‡Øç", readMore: "‡ÆÆ‡Øá‡Æ≤‡ØÅ‡ÆÆ‡Øç", readLess: "‡Æï‡ØÅ‡Æ±‡Øà‡Æµ‡Ææ‡Æï", report: "‡Æ™‡ØÅ‡Æï‡Ææ‡Æ∞‡Øç" },
            kn: { shareTruth: "‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤ø", readMore: "‡≤Æ‡≤§‡≥ç‡≤§‡≤∑‡≥ç‡≤ü‡≥Å", readLess: "‡≤ï‡≤°‡≤ø‡≤Æ‡≥Ü", report: "‡≤µ‡≤∞‡≤¶‡≤ø" },
            ml: { shareTruth: "‡¥™‡¥ô‡µç‡¥ï‡µÅ‡¥µ‡µÜ‡¥ï‡µç‡¥ï‡µÅ‡¥ï", readMore: "‡¥ï‡µÇ‡¥ü‡µÅ‡¥§‡µΩ", readLess: "‡¥ï‡µÅ‡¥±‡¥ö‡µç‡¥ö‡µç", report: "‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡∞∞‡±ç‡¥ü‡µç‡¥ü‡µç" }
        };

        let currentLang = localStorage.getItem('userLang') || 'en';
        let currentCategory = 'all';
        let unsubscribe = null;
        let isUserInteracting = false; 

        // --- 2. UTILITY FUNCTIONS ---
        
        // Updates the dual-clocks in the footer
        function updateClocks() {
            const opt = { hour: '2-digit', minute: '2-digit', hour12: true };
            try {
                document.getElementById('hyd-time').innerText = new Intl.DateTimeFormat('en-IN', { ...opt, timeZone: 'Asia/Kolkata' }).format(new Date());
                document.getElementById('ldn-time').innerText = new Intl.DateTimeFormat('en-GB', { ...opt, timeZone: 'Europe/London' }).format(new Date());
            } catch (e) { /* Element not found yet */ }
        }
        setInterval(updateClocks, 1000); 
        updateClocks();

        // Scroll to Top behavior
        window.onscroll = function() {
            const scrollTab = document.getElementById('scrollTab');
            if (window.scrollY > 300) {
                scrollTab.classList.remove('hidden');
            } else {
                scrollTab.classList.add('hidden');
            }
        };

        function handleScrollAction() { 
            window.scrollTo({ top: 0, behavior: 'smooth' }); 
        }

        // --- 3. RENDERING ENGINE ---

        function renderPosts(posts) {
            // We prevent re-rendering if the user is currently clicking a heart or me-too 
            // so the page doesn't jump while they are interacting.
            if (isUserInteracting) return;

            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            
            // SECURITY FILTER: Auto-hide posts that have been banned or set to hidden
            const activePosts = posts.filter(p => p.status !== "hidden");
            
            // Sort by Timestamp (Newest first)
            activePosts.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

            // Populate the Banner with the "Most Supported" post
            if (activePosts.length > 0) {
                const topPost = [...activePosts].sort((a,b) => (b.supportCount || 0) - (a.supportCount || 0))[0];
                document.getElementById('dailyWisdom').classList.remove('hidden');
                document.getElementById('top-secret-text').innerText = topPost.content;
            }

            // Create individual post cards
            activePosts.forEach(post => {
                const safeContent = encodeURIComponent(post.content);
                const isHearted = localStorage.getItem(`supportCount-${post.id}`);
                const isMeTooed = localStorage.getItem(`meTooCount-${post.id}`);
                
                // Content shortening logic
                const isLong = post.content.length > 300;
                const shortText = isLong ? post.content.substring(0, 300) : post.content;

                const cardHTML = `
                    <div id="post-${post.id}" class="bg-white dark:bg-[#1e293b] p-6 md:p-8 rounded-[32px] border border-slate-100 dark:border-slate-800 shadow-sm mb-6 transition-all hover:shadow-md">
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-[10px] font-black uppercase text-indigo-500 tracking-widest">
                                ${post.category || 'other'}
                            </span>
                            <button onclick="reportPost('${post.id}')" class="text-[9px] font-black text-slate-300 dark:text-slate-500 uppercase hover:text-red-500 transition-colors">
                                ${translations[currentLang].report}
                            </button>
                        </div>
                        
                        <p id="text-${post.id}" data-full="${safeContent}" data-short="${encodeURIComponent(shortText)}" class="text-slate-600 dark:text-slate-300 text-lg leading-relaxed font-medium mb-2 break-words">
                            "${isLong ? shortText + '...' : post.content}"
                        </p>
                        
                        ${isLong ? `
                            <button id="btn-${post.id}" data-state="short" onclick="toggleReadMore('${post.id}')" class="text-indigo-500 font-bold text-sm mb-6">
                                ${translations[currentLang].readMore}
                            </button>
                        ` : '<div class="mb-6"></div>'}
                        
                        <div class="grid grid-cols-2 gap-3 pt-6 border-t border-slate-50 dark:border-slate-800">
                            <div class="flex gap-2">
                                <button onclick="interact(event, '${post.id}', 'supportCount')" class="flex-1 py-3 bg-pink-50 dark:bg-pink-900/10 rounded-2xl text-pink-600 transition-all active:scale-95 ${isHearted ? 'opacity-50 pointer-events-none' : ''}">
                                    ‚ù§Ô∏è <span id="sup-${post.id}">${post.supportCount || 0}</span>
                                </button>
                                <button onclick="interact(event, '${post.id}', 'meTooCount')" class="flex-1 py-3 bg-indigo-50 dark:bg-indigo-900/10 rounded-2xl text-indigo-600 transition-all active:scale-95 ${isMeTooed ? 'opacity-50 pointer-events-none' : ''}">
                                    ü´Ç <span id="metoo-${post.id}">${post.meTooCount || 0}</span>
                                </button>
                            </div>
                            
                            <button onclick="openShare('${post.id}')" class="share-pill flex items-center justify-center gap-2 py-3 rounded-2xl text-white shadow-lg active:scale-95 transition-all">
                                <span class="text-[11px] font-black uppercase tracking-widest">
                                    ${translations[currentLang].shareTruth}
                                </span>
                            </button>
                        </div>
                    </div>`;
                
                feed.insertAdjacentHTML('beforeend', cardHTML);
            });
        }

        // Logic for "Read More" Toggle
        window.toggleReadMore = (id) => {
            const p = document.getElementById(`text-${id}`);
            const btn = document.getElementById(`btn-${id}`);
            const full = decodeURIComponent(p.getAttribute('data-full'));
            const short = decodeURIComponent(p.getAttribute('data-short'));
            
            if(btn.getAttribute('data-state') === "short") {
                p.innerText = `"${full}"`;
                btn.innerText = translations[currentLang].readLess;
                btn.setAttribute('data-state', 'long');
            } else {
                p.innerText = `"${short}..."`;
                btn.innerText = translations[currentLang].readMore;
                btn.setAttribute('data-state', 'short');
            }
        };

        // --- 4. ADVANCED SHARING & IMAGE GENERATION ---

        window.downloadSecret = (id, content) => {
            const shareUrl = `${SITE_URL}/secret.html?id=${id}`;
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            
            // Professional 4:5 Instagram Portrait Card Template
            tempDiv.innerHTML = `
                <div id="capture-${id}" style="width: 1080px; height: 1350px; background: #0b1120; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 80px; font-family: sans-serif; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 20% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(168, 85, 247, 0.1) 0%, transparent 50%);"></div>
                    
                    <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 60px; padding: 100px 60px; width: 100%; min-height: 850px; display: flex; flex-direction: column; justify-content: space-between; z-index: 10; backdrop-filter: blur(20px); box-shadow: 0 50px 100px rgba(0,0,0,0.5);">
                        <div style="text-align: center;">
                            <span style="color: #6366f1; font-weight: 900; text-transform: uppercase; letter-spacing: 6px; font-size: 24px;">An Anonymous Truth</span>
                            <div style="width: 40px; height: 4px; background: #6366f1; margin: 24px auto; border-radius: 2px;"></div>
                        </div>
                        
                        <div style="color: #f1f5f9; font-size: 54px; font-weight: 600; line-height: 1.4; text-align: center; font-style: italic; padding: 0 20px;">
                            "${content}"
                        </div>
                        
                        <div style="text-align: center;">
                            <p style="color: #94a3b8; font-size: 20px; margin-bottom: 15px; font-weight: 500;">Read more secrets on</p>
                            <div style="display: inline-block; background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); padding: 18px 50px; border-radius: 20px; color: white; font-weight: 900; font-size: 30px; letter-spacing: 1px; box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);">
                                confessionindia.in
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 80px; width: 100%; display: flex; justify-content: space-between; align-items: center; z-index: 10; padding: 0 40px;">
                        <div style="display: flex; flex-direction: column;">
                            <span style="color: #475569; font-weight: 800; text-transform: uppercase; letter-spacing: 5px; font-size: 20px;">Confess India</span>
                            <span style="color: #334155; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; margin-top: 5px;">Hyderabad to London</span>
                        </div>
                        <div style="background: white; padding: 10px; border-radius: 15px;">
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=${encodeURIComponent(shareUrl)}" style="width: 90px; height: 90px;">
                        </div>
                    </div>
                </div>`;
            
            document.body.appendChild(tempDiv);

            // Execute the capture
            html2canvas(document.getElementById(`capture-${id}`), { 
                scale: 2, // High resolution
                backgroundColor: '#0b1120'
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `ConfessIndia-Secret-${id}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
                document.body.removeChild(tempDiv);
            });
        };

        function openShare(id) {
            const modal = document.getElementById('shareModal');
            modal.style.display = 'flex';
            
            const postEl = document.getElementById(`post-${id}`);
            const content = decodeURIComponent(postEl.querySelector('p').getAttribute('data-full'));
            const shareUrl = `${SITE_URL}/secret.html?id=${id}`;

            // Button 1: Instagram Card (Download + Copy Link for Story Sticker)
            document.getElementById('igBtn').onclick = () => {
                downloadSecret(id, content);
                navigator.clipboard.writeText(shareUrl);
                alert("Professional Card Downloaded! Link copied to your clipboard. Use the 'Link' sticker on Instagram to paste it!");
            };

            // Button 2: WhatsApp
            document.getElementById('waBtn').onclick = () => {
                window.open(`https://wa.me/?text=${encodeURIComponent(content + "\n\nRead more truths at: " + shareUrl)}`);
            };

            // Button 3: Just Text
            document.getElementById('copyTxtBtn').onclick = () => {
                navigator.clipboard.writeText(content);
                alert("Text copied to clipboard!");
            };

            // Button 4: Just URL
            document.getElementById('copyBtn').onclick = () => {
                navigator.clipboard.writeText(shareUrl);
                alert("Website link copied!");
            };
        }

        function closeShare() { 
            document.getElementById('shareModal').style.display = 'none'; 
        }

        // --- 5. DATA FETCHING ---

        async function loadPosts(category = 'all') {
            if (unsubscribe) unsubscribe(); // Clear existing listener
            
            // Real-time listener from Firestore
            unsubscribe = db.collection('confessions').onSnapshot(snapshot => {
                let allPosts = [];
                snapshot.forEach(doc => {
                    allPosts.push({ id: doc.id, ...doc.data() });
                });

                // Filter by category
                let filtered = category === 'all' ? allPosts : allPosts.filter(p => p.category === category);
                
                // Final filter by selected language
                renderPosts(filtered.filter(p => (p.language || 'en') === currentLang));
            });
        }

        // Language Switcher Logic
        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('userLang', lang);
            
            // Update UI Active State
            document.querySelectorAll('.lang-pill').forEach(btn => {
                btn.classList.toggle('lang-active', btn.id === `lang-${lang}`);
            });
            
            loadPosts(currentCategory);
        }

        // Category Filter Logic
        function filterCat(cat, btn) {
            currentCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(b => {
                b.classList.toggle('cat-active', b === btn);
            });
            loadPosts(cat);
        }

        // Interaction Logic (Like/Me Too)
        window.interact = (e, id, field) => {
            if (localStorage.getItem(`${field}-${id}`)) return;
            
            isUserInteracting = true; // Block UI refresh
            localStorage.setItem(`${field}-${id}`, 'true');
            
            db.collection('confessions').doc(id).update({
                [field]: firebase.firestore.FieldValue.increment(1)
            });

            // Re-allow refreshes after a short delay
            setTimeout(() => { isUserInteracting = false; }, 3000);
        };

        // Report Post Logic
        window.reportPost = (id) => {
            if(confirm("Does this post violate our rules? Reporting helps our moderators keep the community safe.")) {
                db.collection('confessions').doc(id).update({
                    reportCount: firebase.firestore.FieldValue.increment(1)
                });
                alert("Thank you. Our moderators will review this within 24 hours.");
            }
        };

        // Initialize Feed on Page Load
        setLanguage(currentLang);

    </script>
</body>
</html>
