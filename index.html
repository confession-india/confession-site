<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LT5SF025XK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-LT5SF025XK');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="E0eroPpuSrFX_H8NK5GV0vtHNz5S-xScaEDuM25Zth4" />

    <title>Confess India | Share Your Truth Anonymously</title>
    
    <meta name="description" content="Confess India: The safest digital sanctuary to share secrets anonymously.">
    <meta name="theme-color" content="#0f172a">
    <link rel="icon" href="https://fav.farm/ü§´">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="style.css">

    <script>
        if (localStorage.getItem('userLang') === null) { localStorage.setItem('userLang', 'en'); }
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }
    </script>
</head>
<body class="bg-[#fdfdff] dark:bg-[#0b1120] min-h-screen font-sans transition-colors duration-300">

    <div class="sticky top-0 z-[100] bg-slate-900 py-3 overflow-x-auto no-scrollbar border-b border-slate-800">
        <div class="max-w-4xl mx-auto px-4 flex gap-2">
            <button onclick="setLanguage('en')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700" id="lang-en">English</button>
            <button onclick="setLanguage('te')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700" id="lang-te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
            <button onclick="setLanguage('hi')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700" id="lang-hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
            <button onclick="setLanguage('ta')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700" id="lang-ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
        </div>
    </div>

    <header class="sticky top-[52px] z-[90] bg-white/80 dark:bg-[#0b1120]/80 backdrop-blur-xl border-b border-gray-100 dark:border-red-900/30 p-4">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div class="flex flex-col">
                <h1 class="text-2xl font-black bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent leading-none">Confess India</h1>
                <span class="text-[9px] text-slate-400 font-bold tracking-widest uppercase mt-1">Community Feed</span>
            </div>
            <a href="post.html" class="bg-indigo-600 text-white px-5 py-2.5 rounded-2xl shadow-lg font-bold text-sm transition-all hover:scale-105">+ Share Secret</a>
        </div>
    </header>

    <button id="scrollTab" onclick="handleScrollAction()" class="fixed bottom-8 right-8 z-[110] bg-indigo-600 text-white p-4 rounded-2xl shadow-2xl transition-all active:scale-90">
        <svg id="scrollIcon" class="w-6 h-6 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
        </svg>
    </button>

    <main class="max-w-4xl mx-auto p-4">
        <div id="dailyWisdom" class="mb-8 hidden">
            <div class="bg-indigo-600 rounded-[32px] p-6 text-white shadow-xl flex flex-col gap-4 border-4 border-indigo-500/30">
                <div class="flex items-center gap-3">
                    <span class="bg-white/20 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest">üî• Most Supported</span>
                </div>
                <div>
                    <p id="top-secret-text" class="text-lg font-bold italic line-clamp-3">"Loading..."</p>
                    <button id="banner-toggle" onclick="toggleBannerText()" class="hidden text-[10px] font-black uppercase mt-3 opacity-70 hover:opacity-100 underline tracking-widest">Read More</button>
                </div>
            </div>
        </div>

        <div class="flex overflow-x-auto py-6 space-x-3 no-scrollbar items-center">
            <button onclick="filterCat('all', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 text-sm cat-active">Latest</button>
            <button onclick="filterCat('relationship', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 text-sm">Relationships</button>
            <button onclick="filterCat('marriage', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 text-sm">Marriage</button>
        </div>

        <div id="feed" class="space-y-6 min-h-[400px]">
            <div class="animate-pulse bg-slate-100 dark:bg-slate-800/50 h-48 rounded-[32px]"></div>
        </div>

        <section class="mt-20 py-12 border-t border-slate-100 dark:border-slate-800 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="p-6 bg-white dark:bg-slate-800/50 rounded-3xl border border-slate-50 dark:border-slate-800">
                <div class="text-indigo-600 text-xl mb-4">üõ°Ô∏è</div>
                <h4 class="font-bold mb-2">Zero Logs</h4>
                <p class="text-xs text-slate-500">We never store IP addresses or tracking data. Complete anonymity.</p>
            </div>
            <div class="p-6 bg-white dark:bg-slate-800/50 rounded-3xl border border-slate-50 dark:border-slate-800">
                <div class="text-indigo-600 text-xl mb-4">üëª</div>
                <h4 class="font-bold mb-2">No Accounts</h4>
                <p class="text-xs text-slate-500">No email required. Your secrets stay yours and cannot be traced.</p>
            </div>
            <div class="p-6 bg-white dark:bg-slate-800/50 rounded-3xl border border-slate-50 dark:border-slate-800">
                <div class="text-indigo-600 text-xl mb-4">üëÄ</div>
                <h4 class="font-bold mb-2">Human Review</h4>
                <p class="text-xs text-slate-500">Every report is checked by a moderator to keep the community safe.</p>
            </div>
        </section>
    </main>

    <div id="shareModal" class="fixed inset-0 bg-slate-900/95 backdrop-blur-md hidden items-center justify-center z-[10000] p-4" onclick="closeShare()">
        <div class="bg-white dark:bg-slate-800 p-8 rounded-[40px] w-full max-w-sm space-y-3" onclick="event.stopPropagation()">
            <h3 class="font-black text-xl text-center mb-6 dark:text-white italic">Share Truth</h3>
            <div class="grid grid-cols-2 gap-3">
                <button id="waBtn" class="bg-[#25D366] text-white py-4 rounded-2xl font-bold text-xs uppercase tracking-widest">WhatsApp</button>
                <button id="xBtn" class="bg-black text-white py-4 rounded-2xl font-bold text-xs uppercase tracking-widest">X (Twitter)</button>
                <button id="fbBtn" class="bg-[#1877F2] text-white py-4 rounded-2xl font-bold text-xs uppercase tracking-widest">Facebook</button>
                <button id="copyBtn" class="bg-slate-100 dark:bg-slate-700 text-slate-500 py-4 rounded-2xl font-bold text-xs uppercase tracking-widest">Copy Link</button>
            </div>
            <button id="igBtn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-5 rounded-2xl font-black text-xs uppercase tracking-[0.2em] shadow-xl">Download Instagram Card</button>
            <button onclick="closeShare()" class="w-full text-slate-400 font-bold py-2 mt-4 uppercase text-[10px] tracking-widest">Cancel</button>
        </div>
    </div>

    <footer class="bg-[#0f172a] text-slate-500 py-16 px-4 mt-20 border-t border-slate-800 text-center">
        <div class="max-w-4xl mx-auto space-y-8">
            <div class="flex justify-center items-center gap-6 md:gap-12 mb-8">
                <a href="legal.html#rules" class="group flex items-center gap-2 transition-all hover:text-pink-500">
                    <span class="bg-pink-500/10 p-2 rounded-lg group-hover:bg-pink-500/20">‚ù§Ô∏è</span>
                    <span class="text-[10px] font-black uppercase tracking-widest">Support</span>
                </a>
                <div class="h-4 w-[1px] bg-slate-800"></div>
                <a href="#feed" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="group flex items-center gap-2 transition-all hover:text-red-500">
                    <span class="bg-red-500/10 p-2 rounded-lg group-hover:bg-red-500/20">üö©</span>
                    <span class="text-[10px] font-black uppercase tracking-widest">Report</span>
                </a>
            </div>

            <div class="flex justify-center gap-10 text-[10px] font-black uppercase tracking-[0.2em] text-slate-600 border-t border-slate-800/50 pt-8">
                <div class="flex flex-col gap-1">
                    <span class="opacity-40">Hyderabad</span>
                    <span id="hyd-time" class="text-indigo-400 text-sm">--:--</span>
                </div>
                <div class="flex flex-col gap-1">
                    <span class="opacity-40">London</span>
                    <span id="ldn-time" class="text-indigo-400 text-sm">--:--</span>
                </div>
            </div>
            <p class="text-[9px] font-bold text-slate-800 uppercase tracking-[0.3em]">¬© 2026 Confess India ‚Ä¢ Built with Integrity</p>
        </div>
    </footer>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA8JIiJ5sRc5Fxy6qcYAXD8_nA8ELOBwkI", authDomain: "confession-india.firebaseapp.com", projectId: "confession-india", storageBucket: "confession-india.firebasestorage.app", messagingSenderId: "345080016810", appId: "1:345080016810:web:3032f570077ea8d6dd45d3" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const SITE_URL = "https://confessionindia.in";

        let currentLang = localStorage.getItem('userLang') || 'en';
        let currentCategory = 'all';

        // Smart Scroll Logic (Up/Down)
        function handleScrollAction() {
            const isBottom = (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 150;
            if (isBottom) window.scrollTo({top: 0, behavior: 'smooth'});
            else window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'});
        }
        window.onscroll = () => {
            const icon = document.getElementById('scrollIcon');
            const isBottom = (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 150;
            icon.style.transform = isBottom ? 'rotate(180deg)' : 'rotate(0deg)';
        };

        // Banner Read More
        function toggleBannerText() {
            const el = document.getElementById('top-secret-text');
            const btn = document.getElementById('banner-toggle');
            if (el.classList.contains('line-clamp-3')) {
                el.classList.remove('line-clamp-3');
                btn.innerText = "Read Less";
            } else {
                el.classList.add('line-clamp-3');
                btn.innerText = "Read More";
            }
        }

        function renderPosts(posts) {
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            const active = posts.filter(p => p.status !== "hidden").sort((a,b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

            if (active.length > 0) {
                const top = [...active].sort((a,b) => (b.supportCount || 0) - (a.supportCount || 0))[0];
                document.getElementById('top-secret-text').innerText = `"${top.content}"`;
                document.getElementById('dailyWisdom').classList.remove('hidden');
                if (top.content.length > 180) document.getElementById('banner-toggle').classList.remove('hidden');
            }

            active.forEach(post => {
                const isHearted = localStorage.getItem(`supportCount-${post.id}`);
                feed.insertAdjacentHTML('beforeend', `
                    <div class="bg-white dark:bg-[#1e293b] p-6 rounded-[32px] border border-slate-100 dark:border-slate-800 shadow-sm transition-all hover:shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-[9px] font-black uppercase text-indigo-500 tracking-widest">${post.category || 'other'}</span>
                            <button onclick="reportPost('${post.id}')" class="text-[9px] text-slate-300 hover:text-red-500 font-bold">üö© REPORT</button>
                        </div>
                        <p class="text-slate-600 dark:text-slate-300 text-lg mb-6 leading-relaxed break-words">"${post.content}"</p>
                        <div class="flex gap-2">
                            <button onclick="interact('${post.id}', 'supportCount')" class="flex-1 py-3 bg-pink-50 dark:bg-pink-900/10 rounded-2xl text-pink-600 font-bold transition-all active:scale-95 ${isHearted?'opacity-50 pointer-events-none':''}">‚ù§Ô∏è ${post.supportCount || 0}</button>
                            <button onclick="openShare('${post.id}', \`${encodeURIComponent(post.content)}\`)" class="flex-1 py-3 bg-indigo-600 text-white rounded-2xl font-bold transition-all active:scale-95">Share Truth</button>
                        </div>
                    </div>`);
            });
        }

        // Image Gen with Font-Scaling for 2000 Characters
        window.downloadSecret = (id, content) => {
            const shareUrl = `${SITE_URL}/secret.html?id=${id}`;
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'absolute'; tempDiv.style.left = '-9999px';
            
            let fontSize = "52px";
            if (content.length > 400) fontSize = "38px";
            if (content.length > 800) fontSize = "28px";
            if (content.length > 1500) fontSize = "20px";

            tempDiv.innerHTML = `
                <div id="capture-${id}" style="width: 1080px; height: 1350px; background: #0b1120; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 60px; font-family: sans-serif; position: relative;">
                    <div style="background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 60px; padding: 80px 60px; width: 100%; min-height: 900px; display: flex; flex-direction: column; justify-content: center; text-align: center;">
                        <div style="color: #6366f1; font-weight: 900; text-transform: uppercase; letter-spacing: 8px; margin-bottom: 40px; font-size: 24px;">Confess India</div>
                        <div style="color: #ffffff; font-size: ${fontSize}; font-weight: 600; line-height: 1.5; font-style: italic;">"${content}"</div>
                    </div>
                    <div style="width: 100%; margin-top: 60px; display: flex; justify-content: space-between; align-items: center; background: white; padding: 40px; border-radius: 35px;">
                        <div style="display: flex; flex-direction: column;">
                            <div style="color: #0b1120; font-weight: 900; font-size: 36px; letter-spacing: -1px;">confessionindia.in</div>
                            <div style="color: #94a3b8; font-size: 16px; font-weight: 800; text-transform: uppercase; letter-spacing: 3px; margin-top: 5px;">Hyderabad ‚Ä¢ London</div>
                        </div>
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(shareUrl)}&color=0b1120" style="width: 110px; height: 110px;">
                    </div>
                </div>`;
            document.body.appendChild(tempDiv);
            html2canvas(document.getElementById(`capture-${id}`), { scale: 1 }).then(canvas => {
                const link = document.createElement('a'); link.download = `ConfessIndia-${id}.png`;
                link.href = canvas.toDataURL('image/png'); link.click();
                document.body.removeChild(tempDiv);
            });
        };

        function openShare(id, content) {
            const decoded = decodeURIComponent(content);
            const url = `${SITE_URL}/secret.html?id=${id}`;
            document.getElementById('shareModal').style.display = 'flex';
            document.getElementById('igBtn').onclick = () => downloadSecret(id, decoded);
            document.getElementById('waBtn').onclick = () => window.open(`https://wa.me/?text=${encodeURIComponent(decoded + "\n\nRead more: " + url)}`);
            document.getElementById('xBtn').onclick = () => window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent("Read this secret on Confess India: " + url)}`);
            document.getElementById('fbBtn').onclick = () => window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`);
            document.getElementById('copyBtn').onclick = () => { navigator.clipboard.writeText(url); alert("Link Copied!"); };
        }

        function closeShare() { document.getElementById('shareModal').style.display = 'none'; }

        async function loadPosts() {
            db.collection('confessions').onSnapshot(snap => {
                let all = []; snap.forEach(doc => all.push({ id: doc.id, ...doc.data() }));
                let filtered = currentCategory === 'all' ? all : all.filter(p => p.category === currentCategory);
                renderPosts(filtered.filter(p => (p.language || 'en') === currentLang));
            });
        }

        function setLanguage(lang) {
            currentLang = lang; localStorage.setItem('userLang', lang);
            document.querySelectorAll('.lang-pill').forEach(b => b.classList.toggle('lang-active', b.id === `lang-${lang}`));
            loadPosts();
        }

        function filterCat(cat, btn) {
            currentCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.toggle('cat-active', b === btn));
            loadPosts();
        }

        function updateClocks() {
            const opt = { hour: '2-digit', minute: '2-digit', hour12: true };
            document.getElementById('hyd-time').innerText = new Intl.DateTimeFormat('en-IN', { ...opt, timeZone: 'Asia/Kolkata' }).format(new Date());
            document.getElementById('ldn-time').innerText = new Intl.DateTimeFormat('en-GB', { ...opt, timeZone: 'Europe/London' }).format(new Date());
        }
        setInterval(updateClocks, 1000); updateClocks();

        window.interact = (id, field) => {
            if (localStorage.getItem(`${field}-${id}`)) return;
            localStorage.setItem(`${field}-${id}`, 'true');
            db.collection('confessions').doc(id).update({ [field]: firebase.firestore.FieldValue.increment(1) });
        };

        window.reportPost = (id) => {
            if(confirm("Report this post?")) db.collection('confessions').doc(id).update({ reportCount: firebase.firestore.FieldValue.increment(1) });
        };

        setLanguage(currentLang);
    </script>
</body>
</html>
