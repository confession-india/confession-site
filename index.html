<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous Confessions India</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-50 to-indigo-100 min-h-screen">
    <!-- Header with Language Switcher -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-4xl mx-auto p-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                Confess Anonymously
            </h1>
            <div class="flex items-center space-x-4">
                <!-- Language Switcher (visual only) -->
                <select id="langSwitcher" class="p-2 border border-gray-200 rounded-lg bg-white text-sm">
                    <option value="en">üáÆüá≥ English</option>
                    <option value="te">üáÆüá≥ ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                    <option value="hi">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                    <option value="ta">üáÆüá≥ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                    <option value="kn">üáÆüá≥ ‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                    <option value="ml">üáÆüá≥ ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
                </select>
                <a href="post.html" class="bg-purple-600 text-white px-6 py-2 rounded-full hover:bg-purple-700 transition">
                    + Post Confession
                </a>
            </div>
        </div>
    </header>

    <!-- Categories -->
    <div class="max-w-4xl mx-auto p-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 mb-8">
            <button class="cat-btn bg-purple-100 hover:bg-purple-200 px-4 py-2 rounded-lg active-cat" data-cat="all">All</button>
            <button class="cat-btn bg-pink-100 hover:bg-pink-200 px-4 py-2 rounded-lg" data-cat="relationship">Relationships</button>
            <button class="cat-btn bg-blue-100 hover:bg-blue-200 px-4 py-2 rounded-lg" data-cat="family">Family</button>
            <button class="cat-btn bg-green-100 hover:bg-green-200 px-4 py-2 rounded-lg" data-cat="marriage">Marriage</button>
            <button class="cat-btn bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg" data-cat="other">Other</button>
        </div>

        <!-- Confessions Feed -->
        <div id="feed" class="space-y-4"></div>
        <div id="loading" class="text-center py-8 hidden">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"></div>
            <p class="mt-2 text-gray-600">Loading confessions...</p>
        </div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyA8JIiJ5sRc5Fxy6qcYAXD8_nA8ELOBwkI",
            authDomain: "confession-india.firebaseapp.com",
            projectId: "confession-india",
            storageBucket: "confession-india.firebasestorage.app",
            messagingSenderId: "345080016810",
            appId: "1:345080016810:web:3032f570077ea8d6dd45d3"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Category icons
        const categoryIcons = {
            relationship: 'üíî',
            family: 'üë®‚Äçüë©‚Äçüëß',
            marriage: 'üíç',
            other: 'üìù'
        };

        // Load ALL confessions (real-time)
        function loadAllPosts() {
            const feed = document.getElementById('feed');
            const loading = document.getElementById('loading');
            
            loading.classList.remove('hidden');
            
            db.collection('confessions')
                .where('approved', '==', false)
                .orderBy('timestamp', 'desc')
                .limit(20)
                .onSnapshot(snapshot => {
                    loading.classList.add('hidden');
                    
                    if (snapshot.empty) {
                        feed.innerHTML = `
                            <div class="text-center py-12 text-gray-500 bg-white rounded-2xl p-8 shadow-lg">
                                <div class="text-4xl mb-4">‚ú®</div>
                                <h2 class="text-xl font-bold mb-2 text-gray-700">No confessions yet</h2>
                                <p class="mb-6">Be the first Hyderabadi to share anonymously!</p>
                                <a href="post.html" class="bg-purple-600 text-white px-8 py-3 rounded-full hover:bg-purple-700 transition font-semibold">
                                    + Share Your Secret
                                </a>
                            </div>
                        `;
                        return;
                    }
                    
                    let html = '';
                    snapshot.forEach(doc => {
                        const post = doc.data();
                        const timeAgo = post.timestamp ? new Date(post.timestamp.toDate()).toLocaleString('en-IN', { 
                            timeZone: 'Asia/Kolkata',
                            hour: '2-digit',
                            minute: '2-digit'
                        }) : 'Just now';
                        
                        html += `
                            <div class="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all border-l-4 ${
                                post.category === 'relationship' ? 'border-pink-500' :
                                post.category === 'family' ? 'border-blue-500' :
                                post.category === 'marriage' ? 'border-green-500' : 'border-gray-500'
                            }">
                                <div class="flex items-center justify-between mb-4">
                                    <span class="bg-gradient-to-r from-purple-100 to-pink-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">
                                        ${categoryIcons[post.category] || 'üìù'} ${post.category.charAt(0).toUpperCase() + post.category.slice(1)}
                                    </span>
                                    <span class="text-xs text-gray-500">${timeAgo}</span>
                                </div>
                                <h3 class="font-bold text-lg text-gray-900 mb-3">${post.username}</h3>
                                <p class="text-gray-700 leading-relaxed text-base">${post.content}</p>
                            </div>
                        `;
                    });
                    feed.innerHTML = html;
                }, error => {
                    console.error('Firebase error:', error);
                    document.getElementById('feed').innerHTML = '<p class="text-center text-red-500">Error loading posts</p>';
                });
        }

        // Category filtering
        document.querySelectorAll('.cat-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.cat-btn').forEach(b => {
                    b.classList.remove('bg-purple-600', 'text-white');
                });
                btn.classList.add('bg-purple-600', 'text-white');
                
                const category = btn.dataset.cat;
                const feed = document.getElementById('feed');
                const loading = document.getElementById('loading');
                
                if (category === 'all') {
                    loadAllPosts();
                } else {
                    loading.classList.remove('hidden');
                    db.collection('confessions')
                        .where('category', '==', category)
                        .where('approved', '==', false)
                        .orderBy('timestamp', 'desc')
                        .limit(20)
                        .get()
                        .then(snapshot => {
                            loading.classList.add('hidden');
                            if (snapshot.empty) {
                                feed.innerHTML = `
                                    <div class="text-center py-12 text-gray-500 bg-white rounded-2xl p-8 shadow-lg">
                                        <p class="text-lg mb-4">No ${category} confessions yet</p>
                                        <a href="post.html" class="bg-purple-600 text-white px-6 py-2 rounded-full">Share yours</a>
                                    </div>
                                `;
                            } else {
                                let html = '';
                                snapshot.forEach(doc => {
                                    const post = doc.data();
                                    html += `
                                        <div class="bg-white p-6 rounded-2xl shadow-lg border-l-4 border-purple-500">
                                            <h3 class="font-bold">${post.username}</h3>
                                            <p>${post.content}</p>
                                        </div>
                                    `;
                                });
                                feed.innerHTML = html;
                            }
                        });
                }
            });
        });

        // Language switcher (visual only)
        document.getElementById('langSwitcher').addEventListener('change', function() {
            console.log('Language changed to:', this.value);
        });

        // Load feed on page load
        window.addEventListener('load', loadAllPosts);
    </script>
</body>
</html>
