<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LT5SF025XK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-LT5SF025XK');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="E0eroPpuSrFX_H8NK5GV0vtHNz5S-xScaEDuM25Zth4" />
    
    <title>Confess India | Share Your Truth Anonymously</title>
    <meta name="title" content="Confess India | Share Your Truth Anonymously">
    <meta name="description" content="The safest digital space for Indians worldwide to share their truths without judgment, fear, or recognition. 100% Anonymous.">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://confessionindia.in/">
    <meta property="og:title" content="Confess India | Share Your Truth Anonymously">
    <meta property="og:description" content="Read and share anonymous secrets from across India. No cookies, no emails, just the truth.">
    <meta property="og:image" content="https://confessionindia.in/og-image.png"> 
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://confessionindia.in/">
    <meta property="twitter:title" content="Confess India | Share Your Truth Anonymously">
    <meta property="twitter:description" content="Read and share anonymous secrets from across India. No cookies, no emails, just the truth.">
    <meta property="twitter:image" content="https://confessionindia.in/og-image.png">

    <link rel="icon" href="https://fav.farm/ü§´">
    
    <script>
        if (localStorage.getItem('userLang') === null) { localStorage.setItem('userLang', 'en'); }
        const savedTheme = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (savedTheme === 'dark' || (!savedTheme && systemDark)) {
            document.documentElement.classList.add('dark');
        }
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-[#fdfdff] dark:bg-[#0b1120] min-h-screen font-sans transition-colors duration-300">

    <div class="sticky top-0 z-[100] bg-slate-900 py-3 overflow-x-auto no-scrollbar border-b border-slate-800">
        <div class="max-w-4xl mx-auto px-4 flex gap-2">
            <button onclick="setLanguage('en')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-en">English</button>
            <button onclick="setLanguage('te')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
            <button onclick="setLanguage('ta')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
            <button onclick="setLanguage('kn')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</button>
            <button onclick="setLanguage('ml')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
            <button onclick="setLanguage('hi')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
        </div>
    </div>

    <header class="sticky top-[52px] z-[90] bg-white/80 dark:bg-[#0b1120]/80 backdrop-blur-xl global-header border-b border-slate-100 dark:border-slate-800/50">
        <div class="max-w-4xl mx-auto p-4 flex justify-between items-center">
            <div class="flex flex-col">
                <a href="index.html" class="hover:opacity-80 transition-opacity">
                    <h1 class="text-2xl font-black bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent leading-none">Confess India</h1>
                </a>
                <span id="ui-subheading" class="text-[10px] text-gray-400 dark:text-slate-500 font-bold tracking-widest uppercase mt-1 ml-0.5">Community Feed</span>
            </div>
            
            <div class="flex items-center gap-3">
                <button onclick="toggleTheme()" class="p-2.5 rounded-xl bg-slate-50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 transition-all" id="theme-toggle">
                    <svg id="theme-icon-sun" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"></path></svg>
                    <svg id="theme-icon-moon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                </button>
                <a href="post.html" id="ui-share-btn" class="bg-indigo-600 text-white px-5 py-2.5 rounded-2xl shadow-lg font-bold text-sm transition-all hover:bg-indigo-700">+ Share Secret</a>
            </div>
        </div>
    </header>

    <div class="page-wrapper">
        <div id="shareModal" onclick="closeShare()">
            <div class="bg-white dark:bg-[#1e293b] p-8 rounded-[40px] w-full max-w-sm shadow-2xl space-y-3 border dark:border-slate-700" onclick="event.stopPropagation()">
                <h3 class="font-black text-xl text-center mb-6 text-slate-800 dark:text-white">Share Secret</h3>
                <div class="grid grid-cols-1 gap-3">
                    <button id="waBtn" class="flex items-center justify-center gap-3 bg-[#25D366] text-white py-4 rounded-2xl font-bold hover:opacity-90">WhatsApp</button>
                    <button id="fbBtn" class="flex items-center justify-center gap-3 bg-[#1877F2] text-white py-4 rounded-2xl font-bold hover:opacity-90">Facebook</button>
                    <button id="igBtn" class="flex items-center justify-center gap-3 bg-gradient-to-tr from-[#f9ce34] via-[#ee2a7b] to-[#6228d7] text-white py-4 rounded-2xl font-bold hover:opacity-90">Instagram Image</button>
                    <button id="xBtn" class="flex items-center justify-center gap-3 bg-black text-white py-4 rounded-2xl font-bold hover:opacity-90">X (Twitter)</button>
                    <button id="copyTxtBtn" class="flex items-center justify-center gap-3 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 py-4 rounded-2xl font-bold">Copy Secret Text</button>
                    <button id="copyBtn" class="flex items-center justify-center gap-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 py-4 rounded-2xl font-bold">Copy Web Link</button>
                </div>
                <button onclick="closeShare()" class="w-full text-slate-400 font-bold py-2 mt-2 uppercase text-xs tracking-widest">Close</button>
            </div>
        </div>

        <div id="reportModal" onclick="closeReportModal()">
            <div class="bg-white dark:bg-[#1e293b] w-full max-w-md rounded-[32px] shadow-2xl overflow-hidden border dark:border-slate-700" onclick="event.stopPropagation()">
                <div id="reportStep1" class="p-8">
                    <h3 class="text-xl font-black text-slate-800 dark:text-white mb-2">Help the sanctuary</h3>
                    <p class="text-sm text-slate-500 dark:text-slate-400 mb-6 font-medium">What's wrong with this confession?</p>
                    <div class="space-y-3">
                        <button onclick="submitReport('Spam')" class="w-full text-left p-4 rounded-2xl border border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all font-bold text-slate-700 dark:text-slate-200 text-sm">üö´ It's spam or suspicious</button>
                        <button onclick="submitReport('Hate')" class="w-full text-left p-4 rounded-2xl border border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all font-bold text-slate-700 dark:text-slate-200 text-sm">‚öîÔ∏è Hate speech or discrimination</button>
                        <button onclick="submitReport('Harassment')" class="w-full text-left p-4 rounded-2xl border border-slate-100 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-all font-bold text-slate-700 dark:text-slate-200 text-sm">üë§ Targeted harassment</button>
                    </div>
                    <button onclick="closeReportModal()" class="w-full text-center mt-6 text-[10px] font-black uppercase tracking-widest text-slate-400">Cancel</button>
                </div>
                <div id="reportStep2" class="p-10 hidden text-center">
                    <div class="w-16 h-16 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-full flex items-center justify-center text-2xl mx-auto mb-6">‚úì</div>
                    <h3 class="text-xl font-black text-slate-800 dark:text-white mb-4">Report Submitted.</h3>
                    <p class="text-sm text-slate-500 dark:text-slate-400 mb-8">This post has been flagged for human moderation. Thank you for keeping us safe.</p>
                    <button onclick="closeReportModal()" class="w-full bg-slate-900 dark:bg-white dark:text-slate-900 text-white py-4 rounded-2xl font-bold">Back to Feed</button>
                </div>
            </div>
        </div>

        <div id="capture-area">
            <div style="font-weight: 900; font-size: 28px; letter-spacing: 8px; color: #6366f1; margin-bottom: 50px; text-transform: uppercase;">Confess India</div>
            <div id="capture-text" style="font-weight: 500; line-height: 1.5; color: #f8fafc; margin-bottom: 60px; white-space: pre-wrap; word-break: break-word;"></div>
            <div style="font-size: 20px; color: #64748b; border-top: 2px solid #334155; padding-top: 30px; font-weight: bold;">Read more anonymous truths at confessionindia.in</div>
        </div>

        <main class="max-w-4xl mx-auto p-4">
            <div class="flex overflow-x-auto py-6 space-x-3 no-scrollbar items-center">
                <button onclick="filterCat('all', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 transition-all text-sm cat-active" id="cat-all">Latest</button>
                <button onclick="filterCat('relationship', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 transition-all text-sm" id="cat-relationship">Relationships</button>
                <button onclick="filterCat('family', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 transition-all text-sm" id="cat-family">Family</button>
                <button onclick="filterCat('marriage', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 transition-all text-sm" id="cat-marriage">Marriage</button>
                <button onclick="filterCat('work', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 transition-all text-sm" id="cat-work">Career</button>
                <button onclick="filterCat('other', this)" class="cat-btn shrink-0 bg-white dark:bg-slate-800 text-gray-500 dark:text-slate-400 px-6 py-2 rounded-2xl font-bold border border-gray-100 dark:border-slate-700 transition-all text-sm" id="cat-other">Other</button>
            </div>

            <div id="potd-container" class="mb-10"></div>
            <div id="feed" class="grid grid-cols-1 gap-6 mt-2 min-h-[600px]"></div>

            <section class="max-w-4xl mx-auto px-6 py-16 border-t border-slate-100 dark:border-slate-800/50 mt-10">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="group">
                        <div class="w-10 h-10 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 rounded-2xl flex items-center justify-center mb-4 text-xl">üõ°Ô∏è</div>
                        <h4 class="font-black text-[11px] uppercase tracking-widest text-slate-800 dark:text-white mb-2">Zero Logs</h4>
                        <p class="text-[13px] text-slate-500 dark:text-slate-400 leading-relaxed font-medium">We don't store IP addresses or tracking data. Your secrets stay yours.</p>
                    </div>
                    <div class="group">
                        <div class="w-10 h-10 bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-400 rounded-2xl flex items-center justify-center mb-4 text-xl">üëª</div>
                        <h4 class="font-black text-[11px] uppercase tracking-widest text-slate-800 dark:text-white mb-2">No Accounts</h4>
                        <p class="text-[13px] text-slate-500 dark:text-slate-400 leading-relaxed font-medium">No emails. No passwords. No data leaks. Complete anonymity by design.</p>
                    </div>
                    <div class="group">
                        <div class="w-10 h-10 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 rounded-2xl flex items-center justify-center mb-4 text-xl">üëÄ</div>
                        <h4 class="font-black text-[11px] uppercase tracking-widest text-slate-800 dark:text-white mb-2">Moderated</h4>
                        <p class="text-[13px] text-slate-500 dark:text-slate-400 leading-relaxed font-medium">Every report is checked by a person to keep the community kind and safe.</p>
                    </div>
                </div>
            </section>
        </main>

        <footer id="mainFooter" class="bg-[#0f172a] text-slate-400 pt-16 pb-8 px-4 mt-10 border-t border-slate-800">
            <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-12">
                <div class="space-y-4">
                    <h2 class="text-white text-xl font-black italic">Confess<span class="text-indigo-400">India</span></h2>
                    <p class="text-sm leading-relaxed">The safest digital space for Indians worldwide to share their truths.</p>
                    <div class="flex items-center gap-3 bg-slate-800/50 w-fit px-4 py-2 rounded-full border border-slate-700">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse-green"></div>
                        <span class="text-[10px] font-black uppercase tracking-widest text-slate-300">100% Anonymous</span>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-8 md:col-span-2">
                    <div>
                        <h3 class="text-white text-xs font-black uppercase tracking-widest mb-6">Platform</h3>
                        <ul class="space-y-3 text-sm font-bold">
                            <li><a href="legal.html#mission" class="hover:text-white transition-colors">Our Mission</a></li>
                            <li><a href="legal.html#privacy" class="hover:text-white transition-colors">Privacy Policy</a></li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-white text-xs font-black uppercase tracking-widest mb-6">Connect</h3>
                        <ul class="space-y-3 text-sm font-bold">
                            <li><a href="support.html" class="hover:text-white transition-colors">Support</a></li>
                            <li><a href="support.html?type=abuse" class="hover:text-red-400 transition-colors">Report Abuse</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="max-w-4xl mx-auto mt-16 pt-8 border-t border-slate-800 text-center space-y-4">
                <div class="flex justify-center gap-4 text-slate-500 text-[10px] uppercase font-black tracking-widest">
                    <span>üìç HYD: <span id="hyd-time">--:--</span></span>
                    <span class="text-indigo-600">|</span>
                    <span>üá¨üáß LDN: <span id="ldn-time">--:--</span></span>
                </div>
                <p class="text-[10px] tracking-wider">¬© 2026 Confess India. Built with Integrity from HYD to LDN.</p>
            </div>
        </footer>
    </div>

    <div id="dynamic-scroll-btn">
        <button id="scrollActionBtn" class="custom-scroll-pill">
            <svg id="scrollIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <polyline points="19 12 12 19 5 12"></polyline>
            </svg>
        </button>
    </div>
    <div id="mouse-glow"></div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA8JIiJ5sRc5Fxy6qcYAXD8_nA8ELOBwkI", authDomain: "confession-india.firebaseapp.com", projectId: "confession-india", storageBucket: "confession-india.firebasestorage.app", messagingSenderId: "345080016810", appId: "1:345080016810:web:3032f570077ea8d6dd45d3" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const SITE_URL = "https://confessionindia.in";
        
        const translations = {
            en: { shareTruth: "Share Truth", potd: "Post of the Day" },
            te: { shareTruth: "‡∞®‡∞ø‡∞ú‡∞Ç ‡∞™‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø", potd: "‡∞à ‡∞∞‡±ã‡∞ú‡±Å ‡∞â‡∞§‡±ç‡∞§‡∞Æ ‡∞™‡±ã‡∞∏‡±ç‡∞ü‡±ç" }, 
            hi: { shareTruth: "‡§∏‡§ö ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç", potd: "‡§Ü‡§ú ‡§ï‡•Ä ‡§ñ‡§æ‡§∏ ‡§™‡•ã‡§∏‡•ç‡§ü" },
            ta: { shareTruth: "‡Æâ‡Æ£‡Øç‡ÆÆ‡Øà‡ÆØ‡Øà ‡Æ™‡Æï‡Æø‡Æ∞‡Øç", potd: "‡Æá‡Æ©‡Øç‡Æ±‡Øà‡ÆØ ‡Æö‡Æø‡Æ±‡Æ®‡Øç‡Æ§ ‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ" },
            kn: { shareTruth: "‡≤∏‡≤§‡≥ç‡≤Ø‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤ø", potd: "‡≤¶‡≤ø‡≤®‡≤¶ ‡≤™‡≥ã‡≤∏‡≥ç‡≤ü‡≥ç" },
            ml: { shareTruth: "‡¥∏‡¥§‡µç‡¥Ø‡¥Ç ‡¥™‡¥ô‡µç‡¥ï‡µÅ‡¥µ‡µÜ‡¥ï‡µç‡¥ï‡µÅ‡¥ï", potd: "‡¥à ‡¥¶‡¥ø‡¥µ‡¥∏‡¥§‡µç‡¥§‡µÜ ‡¥Æ‡¥ø‡¥ï‡¥ö‡µç‡¥ö ‡¥™‡µã‡¥∏‡µç‡¥±‡µç‡¥±‡µç" }
        };

        let currentLang = localStorage.getItem('userLang') || 'en';
        let currentCategory = 'all';
        let unsubscribe = null;
        let reportingPostId = null;

        // --- THEME ENGINE ---
        function updateThemeIcons() {
            const isDark = document.documentElement.classList.contains('dark');
            document.getElementById('theme-icon-sun').classList.toggle('hidden', !isDark);
            document.getElementById('theme-icon-moon').classList.toggle('hidden', isDark);
        }

        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcons();
            if (navigator.vibrate) navigator.vibrate(5);
        }

        // --- UI UTILS ---
        const glow = document.getElementById('mouse-glow');
        document.addEventListener('mousemove', (e) => {
            glow.style.left = e.clientX + 'px';
            glow.style.top = e.clientY + 'px';
        });

        let lastScrollTop = 0;
        const scrollBtnWrapper = document.getElementById('dynamic-scroll-btn');
        const scrollActionBtn = document.getElementById('scrollActionBtn');
        const scrollIcon = document.getElementById('scrollIcon');

        window.addEventListener('scroll', () => {
            let st = window.pageYOffset || document.documentElement.scrollTop;
            if (st > 400) { scrollBtnWrapper.classList.add('visible'); } 
            else { scrollBtnWrapper.classList.remove('visible'); }

            if (st > lastScrollTop) {
                if (scrollIcon.classList.contains('icon-flip')) { scrollIcon.classList.remove('icon-flip'); }
                scrollActionBtn.onclick = () => window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'});
            } else {
                if (!scrollIcon.classList.contains('icon-flip')) { scrollIcon.classList.add('icon-flip'); }
                scrollActionBtn.onclick = () => window.scrollTo({top: 0, behavior: 'smooth'});
            }
            lastScrollTop = st <= 0 ? 0 : st;
        });

        function updateClocks() {
            const options = { hour: '2-digit', minute: '2-digit', hour12: true };
            document.getElementById('hyd-time').innerText = new Date().toLocaleTimeString('en-US', { ...options, timeZone: 'Asia/Kolkata' });
            document.getElementById('ldn-time').innerText = new Date().toLocaleTimeString('en-US', { ...options, timeZone: 'Europe/London' });
        }
        setInterval(updateClocks, 1000);

        // --- CORE LOGIC ---
        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('userLang', lang);
            document.querySelectorAll('.lang-pill').forEach(btn => btn.classList.remove('lang-active', 'bg-indigo-600', 'text-white'));
            const activeBtn = document.getElementById(`lang-${lang}`);
            if(activeBtn) activeBtn.classList.add('lang-active', 'bg-indigo-600', 'text-white');
            initFeed();
        }

        function filterCat(cat, btn) {
            currentCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('cat-active', 'bg-indigo-600', 'text-white'));
            if(btn) btn.classList.add('cat-active', 'bg-indigo-600', 'text-white');
            initFeed();
        }

        function initFeed() {
            if (unsubscribe) unsubscribe();
            let query = db.collection('confessions').where('language', '==', currentLang);
            if (currentCategory !== 'all') { query = query.where('category', '==', currentCategory); }
            query = query.orderBy('timestamp', 'desc');
            
            unsubscribe = query.onSnapshot(snapshot => {
                const posts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderPosts(posts);
            });
        }

        function renderPosts(posts) {
            const feed = document.getElementById('feed');
            const potdContainer = document.getElementById('potd-container');
            const visiblePosts = posts.filter(post => (post.reportCount || 0) < 10);
            
            if (!visiblePosts.length) { 
                feed.innerHTML = '<div class="text-center py-20 text-slate-500 font-bold">No secrets here yet.</div>'; 
                potdContainer.innerHTML = ''; return; 
            }

            const todayStr = new Date().toISOString().split('T')[0];
            const dateNum = parseInt(todayStr.replace(/-/g, ''));
            const topFive = [...visiblePosts].sort((a,b) => (b.supportCount || 0) - (a.supportCount || 0)).slice(0, 5);
            const potd = topFive[dateNum % topFive.length];

            const langData = translations[currentLang] || translations['en'];
            potdContainer.innerHTML = getCardHTML(potd, true, langData);
            feed.innerHTML = visiblePosts.filter(p => p.id !== potd.id).map(p => getCardHTML(p, false, langData)).join('');

            const urlParams = new URLSearchParams(window.location.search);
            const targetId = urlParams.get('id');
            if(targetId) {
                const el = document.getElementById(`post-${targetId}`);
                if(el) { 
                    el.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
                    el.classList.add('highlight-post');
                    setTimeout(() => el.classList.remove('highlight-post'), 4000);
                }
            }
        }

        function getCardHTML(post, isPotd, langData) {
            const hasReported = localStorage.getItem(`reportCount-${post.id}`);
            const reportActionHTML = hasReported 
                ? `<span class="text-[10px] font-black uppercase text-red-500 report-success">‚úÖ Reported</span>`
                : `<button onclick="openReportModal('${post.id}')" class="text-[10px] font-black uppercase text-slate-400 hover:text-red-500 transition-colors">üö© Report</button>`;

            return `
                <div id="post-${post.id}" class="confession-card ${isPotd ? 'potd-card' : ''} bg-white dark:bg-[#1e293b] p-6 md:p-8 rounded-[32px] border border-slate-100 dark:border-slate-800 shadow-sm mb-4">
                    <div class="flex gap-2 mb-4">
                        ${isPotd ? `<div class="bg-yellow-400 text-black text-[9px] font-black px-3 py-1 rounded-full uppercase tracking-tighter">üèÜ ${langData.potd}</div>` : ''}
                    </div>
                    
                    <div class="mb-4 flex justify-between items-start">
                        <div>
                            <span class="text-xs font-black text-slate-800 dark:text-white block mb-0.5">${post.username || 'Anonymous'}</span>
                            <span class="text-[10px] font-black uppercase text-indigo-500">${post.category}</span>
                            <div class="text-[9px] text-slate-400 font-black uppercase mt-1">${isPotd ? "1 day ago" : timeAgo(post.timestamp)}</div>
                        </div>
                        <div id="report-wrap-${post.id}">${reportActionHTML}</div>
                    </div>

                    <p id="text-${post.id}" class="text-slate-600 dark:text-slate-300 text-lg leading-relaxed font-medium mb-2 break-words whitespace-pre-wrap ${post.content.length > 300 ? 'line-clamp-3' : ''}">${post.content}</p>
                    
                    ${post.content.length > 300 ? `<button id="rm-btn-${post.id}" onclick="toggleReadMore('${post.id}')" class="text-indigo-500 font-bold text-xs mb-6 uppercase tracking-widest cursor-pointer hover:underline">Read More</button>` : '<div class="mb-4"></div>'}
                    
                    <div class="grid grid-cols-2 gap-3 pt-6 border-t border-slate-50 dark:border-slate-800">
                        <div class="flex gap-2">
                            <button onclick="interact(event, '${post.id}', 'supportCount', this)" class="flex-1 py-3 bg-pink-50 dark:bg-pink-900/10 rounded-2xl text-pink-600 text-xs font-black transition-all active:scale-95 ${localStorage.getItem(`supportCount-${post.id}`) ? 'active-interact' : ''}">‚ù§Ô∏è <span class="count">${post.supportCount || 0}</span></button>
                            <button onclick="interact(event, '${post.id}', 'meTooCount', this)" class="flex-1 py-3 bg-indigo-50 dark:bg-indigo-900/10 rounded-2xl text-indigo-600 text-xs font-black transition-all active:scale-95 ${localStorage.getItem(`meTooCount-${post.id}`) ? 'active-interact' : ''}">ü´Ç <span class="count">${post.meTooCount || 0}</span></button>
                        </div>
                        <button onclick="openShare('${post.id}', '${post.category}')" class="btn-brand bg-indigo-600 text-white py-3 rounded-2xl text-[11px] font-black uppercase tracking-widest hover:bg-indigo-700 transition-all">${langData.shareTruth}</button>
                    </div>
                </div>`;
        }

        async function interact(e, id, field, btn) {
            const key = `${field}-${id}`;
            const exists = localStorage.getItem(key);
            const countSpan = btn.querySelector('.count');
            const change = exists ? -1 : 1;
            btn.classList.add('animate-interact');
            countSpan.innerText = Math.max(0, parseInt(countSpan.innerText) + change);
            if(exists) { localStorage.removeItem(key); btn.classList.remove('active-interact'); }
            else { localStorage.setItem(key, 'true'); btn.classList.add('active-interact'); }
            await db.collection('confessions').doc(id).update({ [field]: firebase.firestore.FieldValue.increment(change) });
            setTimeout(() => btn.classList.remove('animate-interact'), 400);
        }

        function openReportModal(id) {
            reportingPostId = id;
            document.getElementById('reportModal').style.display = 'flex';
            document.getElementById('reportStep1').classList.remove('hidden');
            document.getElementById('reportStep2').classList.add('hidden');
        }

        async function submitReport(reason) {
            try {
                await db.collection('reports').add({ postId: reportingPostId, reason, timestamp: firebase.firestore.FieldValue.serverTimestamp() });
                await db.collection('confessions').doc(reportingPostId).update({ reportCount: firebase.firestore.FieldValue.increment(1) });
                localStorage.setItem(`reportCount-${reportingPostId}`, 'true');
                document.getElementById('reportStep1').classList.add('hidden');
                document.getElementById('reportStep2').classList.remove('hidden');
                const wrap = document.getElementById(`report-wrap-${reportingPostId}`);
                if(wrap) wrap.innerHTML = `<span class="text-[10px] font-black uppercase text-red-500 report-success">‚úÖ Reported</span>`;
            } catch(e) { console.error(e); }
        }

        function closeReportModal() { document.getElementById('reportModal').style.display = 'none'; }

        function openShare(id, category) {
            const content = document.getElementById(`text-${id}`).innerText;
            const shareUrl = `${SITE_URL}/index.html?id=${id}&cat=${category}`;
            document.getElementById('shareModal').classList.add('show');
            document.getElementById('waBtn').onclick = () => window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(content.substring(0, 150) + "... Read more at: " + shareUrl)}`);
            document.getElementById('fbBtn').onclick = () => window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`);
            document.getElementById('xBtn').onclick = () => window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(content.substring(0, 100))}`);
            document.getElementById('copyBtn').onclick = () => { navigator.clipboard.writeText(shareUrl); alert("Web Link Copied!"); };
            document.getElementById('copyTxtBtn').onclick = () => { navigator.clipboard.writeText(`"${content}"\n\n- Shared via confessionindia.in`); alert("Text Copied!"); };
            document.getElementById('igBtn').onclick = async () => {
                const btn = document.getElementById('igBtn');
                btn.innerText = "Generating...";
                const captureText = document.getElementById('capture-text');
                captureText.innerText = content;
                const len = content.length;
                if (len > 800) captureText.style.fontSize = "22px";
                else if (len > 500) captureText.style.fontSize = "28px";
                else if (len > 250) captureText.style.fontSize = "34px";
                else captureText.style.fontSize = "44px";
                try {
                    const canvas = await html2canvas(document.getElementById('capture-area'), { scale: 2, backgroundColor: '#0f172a' });
                    const link = document.createElement('a'); 
                    link.download = `Truth-${id}.png`;
                    link.href = canvas.toDataURL(); 
                    link.click();
                } catch(e) { alert("Download failed."); }
                finally { btn.innerText = "Instagram Image"; }
            };
        }

        function closeShare() { document.getElementById('shareModal').classList.remove('show'); }

        function toggleReadMore(id) {
            const p = document.getElementById(`text-${id}`);
            const btn = document.getElementById(`rm-btn-${id}`);
            if (p.classList.contains('line-clamp-3')) {
                p.classList.remove('line-clamp-3'); btn.innerText = "Read Less";
            } else {
                p.classList.add('line-clamp-3'); btn.innerText = "Read More";
                document.getElementById(`post-${id}`).scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function timeAgo(ts) {
            if (!ts) return 'Just now';
            const seconds = Math.floor((new Date() - ts.toDate()) / 1000);
            if (seconds < 3600) return 'Just now';
            let interval = Math.floor(seconds / 3600);
            if (interval < 24) return interval + 'h ago';
            return Math.floor(interval / 24) + 'd ago';
        }

        // Initialize Everything
        updateThemeIcons();
        updateClocks();
        setLanguage(currentLang);
    </script>
</body>
</html>
