<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confess India - Feel Heard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        /* CRITICAL UI FIXES - Ensures components look right even if external CSS fails */
        html, body {
            width: 100%;
            min-height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        /* 1. Category Button Active State */
        .cat-active {
            background-color: #4f46e5 !important; /* Indigo-600 */
            color: white !important;
            border-color: #4338ca !important;
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3);
        }

        /* 2. Language Pill Active State */
        .lang-active {
            background-color: #4f46e5 !important;
            color: white !important;
            border-color: #6366f1 !important;
            font-weight: 800;
        }

        /* 3. Modal Overlay Visibility */
        #shareModal {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(8px);
            z-index: 10000;
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        #shareModal.show {
            display: flex; /* Shown when class added */
        }

        /* 4. Scroll Utilities */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes pulse-green {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        .animate-pulse-green { animation: pulse-green 2s infinite; }
    </style>
</head>
<body class="bg-[#fdfdff] min-h-screen font-sans flex flex-col">

    <button id="scrollTab" onclick="handleScrollAction()" class="fixed bottom-8 right-8 z-[100] bg-indigo-600 text-white p-4 rounded-2xl shadow-2xl flex items-center justify-center hover:bg-indigo-700 active:scale-90 transition-all hidden">
        <svg id="scrollIcon" class="w-6 h-6 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
        </svg>
    </button>

    <div id="shareModal" onclick="closeShare()">
        <div class="bg-white p-8 rounded-[40px] w-full max-w-sm shadow-2xl space-y-3" onclick="event.stopPropagation()">
            <h3 class="font-black text-xl text-center mb-6 text-slate-800">Share Secret</h3>
            <div class="grid grid-cols-1 gap-3">
                <button id="waBtn" class="flex items-center justify-center gap-3 bg-[#25D366] text-white py-4 rounded-2xl font-bold hover:opacity-90">WhatsApp</button>
                <button id="igBtn" class="flex items-center justify-center gap-3 bg-gradient-to-tr from-[#f9ce34] via-[#ee2a7b] to-[#6228d7] text-white py-4 rounded-2xl font-bold hover:opacity-90">Instagram (Image)</button>
                <button id="copyTxtBtn" class="flex items-center justify-center gap-3 bg-indigo-50 text-indigo-600 py-4 rounded-2xl font-bold">Copy Text</button>
                <button id="copyBtn" class="flex items-center justify-center gap-3 bg-slate-100 text-slate-600 py-4 rounded-2xl font-bold">Copy Link</button>
            </div>
            <button onclick="closeShare()" class="w-full text-slate-400 font-bold py-2 mt-2 uppercase text-xs">Close</button>
        </div>
    </div>

    <div class="bg-slate-900 py-3 overflow-x-auto no-scrollbar border-b border-slate-800 sticky top-0 z-[60]">
        <div class="max-w-4xl mx-auto px-4 flex gap-2">
            <button onclick="setLanguage('en')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-en">English</button>
            <button onclick="setLanguage('hi')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
            <button onclick="setLanguage('te')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
            <button onclick="setLanguage('ta')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
            <button onclick="setLanguage('kn')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap" id="lang-kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</button>
        </div>
    </div>

    <header class="bg-white/80 backdrop-blur-xl border-b border-gray-100 sticky top-[52px] z-50">
        <div class="max-w-4xl mx-auto p-4 flex justify-between items-center">
            <div class="flex flex-col">
                <a href="index.html" class="hover:opacity-80">
                    <h1 class="text-2xl font-black bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent leading-none">Confess India</h1>
                </a>
                <span id="ui-subheading" class="text-[10px] text-gray-400 font-bold tracking-widest uppercase mt-1">Community Feed</span>
            </div>
            <a href="post.html" id="ui-share-btn" class="bg-indigo-600 text-white px-5 py-2.5 rounded-2xl shadow-lg font-bold text-sm hover:bg-indigo-700 transition-all">+ Share Secret</a>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 flex-grow w-full">
        <div id="dailyWisdom" class="mb-4 hidden">
            <div class="bg-indigo-600 rounded-[32px] p-8 text-white shadow-2xl shadow-indigo-200 flex flex-col md:flex-row items-center gap-6 border-4 border-indigo-400/20">
                <div class="bg-white/20 p-5 rounded-3xl text-3xl">üî•</div>
                <div class="flex-1 text-center md:text-left">
                    <h3 class="text-[10px] font-black uppercase tracking-widest opacity-70 mb-2">Most Supported Today</h3>
                    <p id="top-secret-text" class="text-xl font-bold leading-tight italic">"Loading..."</p>
                </div>
            </div>
        </div>

        <div class="flex overflow-x-auto py-6 space-x-3 no-scrollbar items-center">
            <button onclick="filterCat('all', this)" class="cat-btn shrink-0 bg-white text-gray-500 px-6 py-2.5 rounded-2xl font-bold border border-gray-100 shadow-sm transition-all text-sm cat-active" id="cat-all">Latest</button>
            <button onclick="filterCat('relationship', this)" class="cat-btn shrink-0 bg-white text-gray-500 px-6 py-2.5 rounded-2xl font-bold border border-gray-100 shadow-sm transition-all text-sm" id="cat-rel">Relationships</button>
            <button onclick="filterCat('family', this)" class="cat-btn shrink-0 bg-white text-gray-500 px-6 py-2.5 rounded-2xl font-bold border border-gray-100 shadow-sm transition-all text-sm" id="cat-fam">Family</button>
            <button onclick="filterCat('marriage', this)" class="cat-btn shrink-0 bg-white text-gray-500 px-6 py-2.5 rounded-2xl font-bold border border-gray-100 shadow-sm transition-all text-sm" id="cat-mar">Marriage</button>
        </div>

        <div id="feed" class="grid grid-cols-1 gap-6 min-h-[400px]"></div>

        <section class="mt-20 py-12 border-t border-slate-100">
            <div class="text-center mb-10">
                <span class="text-[10px] font-black text-indigo-600 uppercase tracking-[0.3em]">Privacy First</span>
                <h2 class="text-2xl font-black text-slate-800 mt-2">Your Identity is Protected</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm">
                    <div class="w-10 h-10 bg-indigo-50 text-indigo-600 rounded-xl flex items-center justify-center mb-4 text-xl">üõ°Ô∏è</div>
                    <h4 class="font-bold text-slate-800 mb-2">Zero Logs</h4>
                    <p class="text-sm text-slate-500 leading-relaxed">No IP tracking. No metadata storage. Complete privacy.</p>
                </div>
                <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm">
                    <div class="w-10 h-10 bg-indigo-50 text-indigo-600 rounded-xl flex items-center justify-center mb-4 text-xl">üëª</div>
                    <h4 class="font-bold text-slate-800 mb-2">No Accounts</h4>
                    <p class="text-sm text-slate-500 leading-relaxed">No emails or passwords. Just post and stay anonymous.</p>
                </div>
                <div class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm">
                    <div class="w-10 h-10 bg-indigo-50 text-indigo-600 rounded-xl flex items-center justify-center mb-4 text-xl">üëÄ</div>
                    <h4 class="font-bold text-slate-800 mb-2">Moderated</h4>
                    <p class="text-sm text-slate-500 leading-relaxed">Keeping the platform safe from hate and spam.</p>
                </div>
            </div>
        </section>
    </main>

    <footer id="mainFooter" class="bg-[#0f172a] text-slate-400 py-16 px-4 mt-auto">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-white text-xl font-black italic mb-4">Confess<span class="text-indigo-400">India</span></h2>
            <p class="text-sm max-w-md mx-auto mb-8">The safest digital space for Indians worldwide to share truths without judgment.</p>
            <div class="flex justify-center gap-6 text-xs font-bold uppercase tracking-widest">
                <a href="legal.html" class="hover:text-white">Privacy</a>
                <a href="legal.html" class="hover:text-white">Rules</a>
                <a href="support.html" class="hover:text-white">Support</a>
            </div>
            <p class="text-[10px] mt-12 opacity-40 italic">¬© 2026 Confess India. Built for the unheard.</p>
        </div>
    </footer>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA8JIiJ5sRc5Fxy6qcYAXD8_nA8ELOBwkI", authDomain: "confession-india.firebaseapp.com", projectId: "confession-india", storageBucket: "confession-india.firebasestorage.app", messagingSenderId: "345080016810", appId: "1:345080016810:web:3032f570077ea8d6dd45d3" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const translations = {
            en: { meToo: "Me Too", report: "Report", latest: "Latest", rel: "Relationships", fam: "Family", mar: "Marriage", oth: "Other", shareBtn: "+ Share Secret", sub: "Community Feed" },
            hi: { meToo: "‡§Æ‡•à‡§Ç ‡§≠‡•Ä", report: "‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü", latest: "‡§®‡§µ‡•Ä‡§®‡§§‡§Æ", rel: "‡§∞‡§ø‡§∂‡•ç‡§§‡•á", fam: "‡§™‡§∞‡§ø‡§µ‡§æ‡§∞", mar: "‡§∂‡§æ‡§¶‡•Ä", oth: "‡§Ö‡§®‡•ç‡§Ø", shareBtn: "+ ‡§∞‡§æ‡§ú ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç", sub: "‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ü‡•Ä ‡§´‡•Ä‡§°" },
            te: { meToo: "‡∞®‡±á‡∞®‡±Å ‡∞ï‡±Ç‡∞°‡∞æ", report: "‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡±ç", latest: "‡∞§‡∞æ‡∞ú‡∞æ", rel: "‡∞∏‡∞Ç‡∞¨‡∞Ç‡∞ß‡∞æ‡∞≤‡±Å", fam: " ‡∞ï‡±Å‡∞ü‡±Å‡∞Ç‡∞¨‡∞Ç", mar: "‡∞µ‡∞ø‡∞µ‡∞æ‡∞π‡∞Ç", oth: "‡∞á‡∞§‡∞∞", shareBtn: "+ ‡∞∞‡∞π‡∞∏‡±ç‡∞Ø‡∞Ç ‡∞™‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø", sub: "‡∞ï‡∞Æ‡±ç‡∞Ø‡±Ç‡∞®‡∞ø‡∞ü‡±Ä ‡∞´‡±Ä‡∞°‡±ç" },
            ta: { meToo: "‡Æ®‡Ææ‡Æ©‡ØÅ‡ÆÆ‡Øç", report: "‡Æ™‡ØÅ‡Æï‡Ææ‡Æ∞‡Øç", latest: "‡Æö‡ÆÆ‡ØÄ‡Æ™‡Æ§‡Øç‡Æ§‡Æø‡ÆØ", rel: "‡Æâ‡Æ±‡Æµ‡ØÅ‡Æï‡Æ≥‡Øç", fam: "‡Æï‡ØÅ‡Æü‡ØÅ‡ÆÆ‡Øç‡Æ™‡ÆÆ‡Øç", mar: "‡Æ§‡Æø‡Æ∞‡ØÅ‡ÆÆ‡Æ£‡ÆÆ‡Øç", oth: "‡ÆÆ‡Æ±‡Øç‡Æ±‡Æµ‡Øà", shareBtn: "+ ‡Æ™‡Æï‡Æø‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç", sub: "‡Æö‡ÆÆ‡ØÇ‡Æï ‡Æä‡Æü‡Øç‡Æü‡ÆÆ‡Øç" },
            kn: { meToo: "‡≤®‡≤æ‡≤®‡≥Å ‡≤ï‡≥Ç‡≤°", report: "‡≤µ‡≤∞‡≤¶‡≤ø", latest: "‡≤á‡≤§‡≥ç‡≤§‡≥Ä‡≤ö‡≤ø‡≤®", rel: "‡≤∏‡≤Ç‡≤¨‡≤Ç‡≤ß‡≤ó‡≤≥‡≥Å", fam: "‡≤ï‡≥Å‡≤ü‡≥Å‡≤Ç‡≤¨", mar: "‡≤Æ‡≤¶‡≥Å‡≤µ‡≥Ü", oth: "‡≤á‡≤§‡≤∞‡≥Ü", shareBtn: "+ ‡≤∞‡≤π‡≤∏‡≥ç‡≤Ø ‡≤π‡≤Ç‡≤ö‡≤ø‡≤ï‡≥ä‡≤≥‡≥ç‡≤≥‡≤ø", sub: "‡≤∏‡≤Æ‡≥Å‡≤¶‡≤æ‡≤Ø ‡≤´‡≥Ä‡≤°‡≥ç" }
        };

        let currentLang = localStorage.getItem('userLang') || 'en';
        let currentCategory = 'all';
        let unsubscribe = null;

        const scrollTab = document.getElementById('scrollTab');
        const scrollIcon = document.getElementById('scrollIcon');
        let isAtBottom = false;

        window.onscroll = function() {
            if (window.scrollY > 300) scrollTab.classList.remove('hidden');
            else scrollTab.classList.add('hidden');
            
            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 200) {
                scrollIcon.style.transform = "rotate(180deg)";
                isAtBottom = true;
            } else {
                scrollIcon.style.transform = "rotate(0deg)";
                isAtBottom = false;
            }
        };

        function handleScrollAction() {
            if (isAtBottom) window.scrollTo({ top: 0, behavior: 'smooth' });
            else window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        function timeAgo(date) {
            if (!date) return 'Just now';
            const seconds = Math.floor((new Date() - date.toDate()) / 1000);
            if (seconds < 60) return "Just now";
            const mins = Math.floor(seconds / 60);
            if (mins < 60) return mins + "m ago";
            const hours = Math.floor(mins / 60);
            if (hours < 24) return hours + "h ago";
            return Math.floor(hours / 24) + "d ago";
        }

        function renderPosts(posts) {
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            
            posts.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

            if (posts.length > 0) {
                const topPost = [...posts].sort((a,b) => (b.supportCount || 0) - (a.supportCount || 0))[0];
                document.getElementById('dailyWisdom').classList.remove('hidden');
                document.getElementById('top-secret-text').innerText = `"${topPost.content}"`;
            }

            posts.forEach(post => {
                const isHearted = localStorage.getItem(`supportCount-${post.id}`);
                const isMeTooed = localStorage.getItem(`meTooCount-${post.id}`);
                
                feed.insertAdjacentHTML('beforeend', `
                    <div class="bg-white p-8 rounded-[32px] border border-slate-100 shadow-sm transition-all duration-300 hover:-translate-y-1 hover:shadow-xl">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex flex-col gap-1">
                                <div class="flex items-center">
                                    <span class="text-[10px] font-black uppercase bg-indigo-50 px-2 py-1 rounded text-indigo-500 mr-2">${post.category || 'other'}</span>
                                    <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">BY ${post.username || 'ANONYMOUS'}</h4>
                                </div>
                                <span class="text-[9px] text-slate-300 font-bold">${timeAgo(post.timestamp)}</span>
                            </div>
                            <button onclick="reportPost('${post.id}')" class="text-[9px] font-black text-slate-300 uppercase hover:text-red-500">REPORT</button>
                        </div>
                        <p class="text-slate-600 text-lg leading-relaxed font-medium mb-8">"${post.content}"</p>
                        <div class="flex items-center justify-between pt-6 border-t border-slate-50">
                            <div class="flex items-center space-x-3">
                                <button onclick="interact(event, '${post.id}', 'supportCount')" class="flex items-center gap-2 px-4 py-2 bg-pink-50 rounded-full text-pink-600 active:scale-125 transition-transform ${isHearted ? 'opacity-50' : ''}">
                                    <span class="text-xs">‚ù§Ô∏è</span> <span class="text-xs font-black" id="sup-${post.id}">${post.supportCount || 0}</span>
                                </button>
                                <button onclick="interact(event, '${post.id}', 'meTooCount')" class="flex items-center gap-2 px-4 py-2 bg-indigo-50 rounded-full text-indigo-600 active:scale-125 transition-transform ${isMeTooed ? 'opacity-50' : ''}">
                                    <span class="text-xs">ü´Ç</span> <span class="text-xs font-black">${translations[currentLang].meToo} (<span id="metoo-${post.id}">${post.meTooCount || 0}</span>)</span>
                                </button>
                            </div>
                            <button onclick="openShare('${post.content.replace(/'/g, "\\'")}', '${post.id}')" class="p-2 bg-slate-50 rounded-full text-slate-400 hover:bg-indigo-50">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92z"/></svg>
                            </button>
                        </div>
                    </div>`);
            });
        }

        async function loadPosts(category = 'all') {
            if (unsubscribe) unsubscribe();
            unsubscribe = db.collection('confessions').onSnapshot(snapshot => {
                let posts = [];
                snapshot.forEach(doc => posts.push({ id: doc.id, ...doc.data() }));
                let filtered = category === 'all' ? posts : posts.filter(p => p.category === category);
                renderPosts(filtered.filter(p => (p.language || 'en') === currentLang));
            });
        }

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('userLang', lang);
            document.querySelectorAll('.lang-pill').forEach(b => b.classList.remove('lang-active'));
            document.getElementById(`lang-${lang}`).classList.add('lang-active');
            
            // Update UI Texts
            document.getElementById('ui-subheading').innerText = translations[lang].sub;
            document.getElementById('ui-share-btn').innerText = translations[lang].shareBtn;
            document.getElementById('cat-all').innerText = translations[lang].latest;
            
            loadPosts(currentCategory);
        }

        function filterCat(cat, btn) {
            currentCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('cat-active'));
            btn.classList.add('cat-active');
            loadPosts(cat);
        }

        window.interact = (e, id, field) => {
            if (localStorage.getItem(`${field}-${id}`)) return;
            localStorage.setItem(`${field}-${id}`, 'true');
            db.collection('confessions').doc(id).update({ [field]: firebase.firestore.FieldValue.increment(1) });
        };

        function openShare(text, id) {
            document.getElementById('shareModal').classList.add('show');
            const url = window.location.href;
            document.getElementById('waBtn').onclick = () => window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text + " " + url)}`);
            document.getElementById('copyBtn').onclick = () => { navigator.clipboard.writeText(url); alert("Link Copied!"); };
            document.getElementById('copyTxtBtn').onclick = () => { navigator.clipboard.writeText(text); alert("Text Copied!"); };
        }

        function closeShare() { document.getElementById('shareModal').classList.remove('show'); }

        setLanguage(currentLang);
    </script>
</body>
</html>
