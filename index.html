<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confess India - Feel Heard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .post-card { border-radius: 28px; transition: transform 0.2s ease; }
        .lang-active { background: #6366f1 !important; color: white !important; border-color: #6366f1 !important; transform: scale(1.05); }
        .cat-active { background-color: #0f172a !important; color: white !important; border-color: #0f172a !important; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-post { animation: fadeIn 0.4s ease forwards; }
        
        /* Modal Style */
        #shareModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        #shareModal.show { display: flex; }
        .modal-content { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="bg-[#fdfdff] min-h-screen font-sans">

    <div id="shareModal" onclick="closeShare()">
        <div class="bg-white p-8 rounded-[40px] w-full max-w-sm shadow-2xl space-y-3 modal-content" onclick="event.stopPropagation()">
            <h3 class="font-black text-xl text-center mb-6">Share Secret</h3>
            <div class="grid grid-cols-1 gap-3">
                <button id="waBtn" class="flex items-center justify-center gap-3 bg-[#25D366] text-white py-4 rounded-2xl font-bold transition-transform active:scale-95">WhatsApp</button>
                <button id="igBtn" class="flex items-center justify-center gap-3 bg-gradient-to-tr from-[#f9ce34] via-[#ee2a7b] to-[#6228d7] text-white py-4 rounded-2xl font-bold transition-transform active:scale-95">Instagram</button>
                <button id="fbBtn" class="flex items-center justify-center gap-3 bg-[#1877F2] text-white py-4 rounded-2xl font-bold transition-transform active:scale-95">Facebook</button>
                <button id="xBtn" class="flex items-center justify-center gap-3 bg-black text-white py-4 rounded-2xl font-bold transition-transform active:scale-95">X (Twitter)</button>
                <button id="copyBtn" class="flex items-center justify-center gap-3 bg-slate-100 text-slate-600 py-4 rounded-2xl font-bold transition-transform active:scale-95">Copy Link</button>
            </div>
            <button onclick="closeShare()" class="w-full text-slate-400 font-bold py-2 mt-2">Close</button>
        </div>
    </div>

    <div class="bg-slate-900 py-3 overflow-x-auto no-scrollbar border-b border-slate-800 sticky top-0 z-[60]">
        <div class="max-w-4xl mx-auto px-4 flex gap-2">
            <button onclick="setLanguage('en')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap transition-all" id="lang-en">English</button>
            <button onclick="setLanguage('te')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap transition-all" id="lang-te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</button>
            <button onclick="setLanguage('ta')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap transition-all" id="lang-ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
            <button onclick="setLanguage('kn')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap transition-all" id="lang-kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</button>
            <button onclick="setLanguage('ml')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap transition-all" id="lang-ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
            <button onclick="setLanguage('hi')" class="lang-pill px-4 py-1.5 rounded-full text-[11px] font-black uppercase tracking-widest bg-slate-800 text-slate-400 border border-slate-700 whitespace-nowrap transition-all" id="lang-hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
        </div>
    </div>

    <header class="bg-white/80 backdrop-blur-xl border-b border-gray-100 sticky top-[52px] z-50">
        <div class="max-w-4xl mx-auto p-4 flex justify-between items-center">
            <div class="flex flex-col">
                <h1 class="text-2xl font-black bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent leading-none">Confess India</h1>
                <span id="ui-subheading" class="text-[10px] text-gray-400 font-bold tracking-widest uppercase mt-1 ml-0.5">Community Feed</span>
            </div>
            <a href="post.html" id="ui-share-btn" class="bg-indigo-600 text-white px-5 py-2.5 rounded-2xl hover:bg-slate-900 transition-all shadow-lg font-bold text-sm">+ Share Secret</a>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4">
        <div class="flex overflow-x-auto py-6 space-x-3 no-scrollbar items-center">
            <button onclick="filterCat('all', this)" class="cat-btn shrink-0 bg-white text-gray-500 px-6 py-2 rounded-2xl font-bold border border-gray-100 transition-all text-sm cat-active" id="cat-all">Latest</button>
            <button onclick="filterCat('relationship', this)" class="cat-btn shrink-0 bg-white text-gray-500 px-6 py-2 rounded-2xl font-bold border border-gray-100 transition-all text-sm" id="cat-rel">Relationships</button>
            <button onclick="filterCat('family', this)" class="cat-btn shrink-0 bg-white text-gray-500 px-6 py-2 rounded-2xl font-bold border border-gray-100 transition-all text-sm" id="cat-fam">Family</button>
            <button onclick="filterCat('marriage', this)" class="cat-btn shrink-0 bg-white text-gray-500 px-6 py-2 rounded-2xl font-bold border border-gray-100 transition-all text-sm" id="cat-mar">Marriage</button>
            <button onclick="filterCat('other', this)" class="cat-btn shrink-0 bg-white text-gray-500 px-6 py-2 rounded-2xl font-bold border border-gray-100 transition-all text-sm" id="cat-oth">Other</button>
        </div>

        <div id="feed" class="grid grid-cols-1 gap-6 mt-2"></div>
    </main>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA8JIiJ5sRc5Fxy6qcYAXD8_nA8ELOBwkI", authDomain: "confession-india.firebaseapp.com", projectId: "confession-india", storageBucket: "confession-india.firebasestorage.app", messagingSenderId: "345080016810", appId: "1:345080016810:web:3032f570077ea8d6dd45d3" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        const translations = {
            en: { meToo: "Me Too", report: "Report" },
            te: { meToo: "‡∞®‡±á‡∞®‡±Å ‡∞ï‡±Ç‡∞°‡∞æ", report: "‡∞∞‡∞ø‡∞™‡±ã‡∞∞‡±ç‡∞ü‡±ç" },
            hi: { meToo: "‡§Æ‡•à‡§Ç ‡§≠‡•Ä", report: "‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü" },
            ta: { meToo: "‡Æ®‡Ææ‡Æ©‡ØÅ‡ÆÆ‡Øç", report: "‡Æ™‡ØÅ‡Æï‡Ææ‡Æ∞‡Øç" },
            kn: { meToo: "‡≤®‡≤æ‡≤®‡≥Å ‡≤ï‡≥Ç‡≤°", report: "‡≤µ‡≤∞‡≤¶‡≤ø" },
            ml: { meToo: "‡¥û‡¥æ‡¥®‡µÅ‡¥Ç", report: "‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç" }
        };

        let currentLang = localStorage.getItem('userLang') || 'en';
        let currentCategory = 'all';
        let unsubscribe = null;

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('userLang', lang);
            document.querySelectorAll('.lang-pill').forEach(btn => btn.classList.remove('lang-active'));
            document.getElementById(`lang-${lang}`).classList.add('lang-active');
            loadPosts(currentCategory); 
        }

        function filterCat(cat, btn) {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('cat-active'));
            btn.classList.add('cat-active');
            loadPosts(cat);
        }

        function loadPosts(category = 'all') {
            currentCategory = category;
            const feed = document.getElementById('feed');
            if (unsubscribe) unsubscribe();
            
            let query = db.collection('confessions').orderBy('timestamp', 'desc');
            if (category !== 'all') query = query.where('category', '==', category.toLowerCase());

            unsubscribe = query.limit(50).onSnapshot(snapshot => {
                const existingCards = feed.querySelectorAll('.post-card').length;
                if(snapshot.size === existingCards) {
                    snapshot.docChanges().forEach(change => {
                        if (change.type === "modified") {
                            const data = change.doc.data();
                            const card = document.getElementById(`post-${change.doc.id}`);
                            if(card) {
                                card.querySelector('.support-val').innerText = data.supportCount || 0;
                                card.querySelector('.metoo-val').innerText = data.meTooCount || 0;
                            }
                        }
                    });
                    return;
                }

                feed.innerHTML = '';
                snapshot.forEach(doc => {
                    const post = doc.data();
                    if (post.language && post.language !== currentLang) return; 
                    feed.insertAdjacentHTML('beforeend', `
                        <div id="post-${doc.id}" class="bg-white p-8 post-card shadow-sm border border-slate-50 animate-post mb-6">
                            <div class="flex justify-between items-start mb-6">
                                <span class="text-[9px] font-black uppercase bg-indigo-50 px-2 py-1 rounded text-indigo-500">${post.category || 'other'}</span>
                                <button onclick="reportPost('${doc.id}')" class="text-[9px] font-black text-slate-300 uppercase hover:text-red-500 transition-colors">${translations[currentLang].report}</button>
                            </div>
                            <p class="text-slate-600 text-lg leading-relaxed font-medium mb-8">"${post.content}"</p>
                            <div class="flex items-center justify-between pt-6 border-t border-slate-50">
                                <div class="flex items-center space-x-3">
                                    <button onclick="interact('${doc.id}', 'supportCount')" class="flex items-center gap-2 px-4 py-2 bg-pink-50 rounded-full text-pink-600 active:scale-90 transition-all">
                                        <span class="text-xs">‚ù§Ô∏è</span> <span class="text-xs font-black support-val">${post.supportCount || 0}</span>
                                    </button>
                                    <button onclick="interact('${doc.id}', 'meTooCount')" class="flex items-center gap-2 px-4 py-2 bg-indigo-50 rounded-full text-indigo-600 active:scale-90 transition-all">
                                        <span class="text-xs">ü´Ç</span> <span class="text-xs font-black">${translations[currentLang].meToo} (<span class="metoo-val">${post.meTooCount || 0}</span>)</span>
                                    </button>
                                </div>
                                <button onclick="openShare()" class="p-2 bg-slate-50 rounded-full hover:bg-indigo-50 transition-all group">
                                    <svg class="w-5 h-5 text-slate-400 group-hover:text-indigo-600" fill="currentColor" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92c0-1.61-1.31-2.92-2.92-2.92z"/></svg>
                                </button>
                            </div>
                        </div>`);
                });
            });
        }

        window.interact = (id, field) => {
            db.collection('confessions').doc(id).update({ [field]: firebase.firestore.FieldValue.increment(1) });
        };

        window.reportPost = (id) => {
            if(confirm("Report this post for inappropriate content?")) {
                db.collection('confessions').doc(id).update({ reportCount: firebase.firestore.FieldValue.increment(1) });
                alert("Thank you. Our team will review this.");
            }
        };

        function openShare() {
            const url = window.location.href;
            const text = encodeURIComponent("Read these secrets on Confess India: ");
            
            document.getElementById('waBtn').onclick = () => window.open(`https://api.whatsapp.com/send?text=${text}${url}`);
            document.getElementById('igBtn').onclick = () => window.open(`https://www.instagram.com/`);
            document.getElementById('fbBtn').onclick = () => window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`);
            document.getElementById('xBtn').onclick = () => window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`);
            document.getElementById('copyBtn').onclick = () => {
                navigator.clipboard.writeText(url);
                alert("Link copied! Paste it in your Instagram Story.");
            };
            
            document.getElementById('shareModal').classList.add('show');
        }

        function closeShare() { document.getElementById('shareModal').classList.remove('show'); }

        setLanguage(currentLang);
    </script>
</body>
</html>
