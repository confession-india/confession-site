<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Your Secret - Confess India</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-[#fdfdff] min-h-screen font-sans text-slate-900 flex flex-col">

    <div id="toast">
        <div class="bg-indigo-600 text-white px-8 py-4 rounded-full shadow-2xl font-bold flex items-center gap-3">
            <span>‚ú®</span> Secret Sent Anonymously
        </div>
    </div>

    <header class="bg-white/80 backdrop-blur-xl border-b border-gray-100 sticky top-0 z-50">
        <div class="max-w-4xl mx-auto p-4 flex justify-between items-center">
            <div class="flex flex-col">
                <a href="index.html" class="hover:opacity-80 transition-opacity">
                    <h1 class="text-2xl font-black bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent leading-none">Confess India</h1>
                </a>
                <span class="text-[10px] text-gray-400 font-bold tracking-widest uppercase mt-1 ml-0.5">Share Your Truth</span>
            </div>
            <a href="index.html" class="bg-slate-50 text-slate-400 px-4 py-2 rounded-xl font-bold text-[10px] hover:text-red-500 hover:bg-red-50 transition-all uppercase tracking-widest border border-slate-100">Cancel</a>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-6 py-10 flex-grow">
        
        <div class="mb-10">
            <label class="text-[10px] font-black uppercase tracking-widest text-slate-400 ml-1 mb-2 block">Live Preview</label>
            <div id="previewContainer" class="p-8 bg-white shadow-sm preview-card">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex flex-col gap-1">
                        <div class="flex items-center">
                            <span id="p-cat" class="text-[10px] font-black uppercase bg-indigo-50 px-2 py-1 rounded text-indigo-500 mr-2">OTHER</span>
                            <h4 id="p-user" class="text-[10px] font-black text-slate-400 uppercase tracking-widest inline-block">BY ANONYMOUS</h4>
                        </div>
                        <span id="p-lang-tag" class="text-[9px] text-slate-300 font-bold ml-0.5 uppercase tracking-tighter">English Feed</span>
                    </div>
                </div>
                <p id="p-msg" class="text-slate-600 text-lg leading-relaxed font-medium mb-2 italic opacity-60">"Your truth starts here..."</p>
            </div>
        </div>

        <div class="bg-white rounded-[40px] shadow-2xl shadow-slate-200/50 border border-slate-50 overflow-hidden">
            <form id="postForm" class="p-8 space-y-8">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-[11px] font-black text-indigo-600 uppercase tracking-widest mb-2 ml-1">Pen Name</label>
                        <input type="text" id="userInput" placeholder="Silent Lion / Lioness" class="w-full p-4 bg-slate-50 border-2 border-transparent rounded-2xl outline-none input-focus-effect font-bold text-slate-700" required>
                    </div>
                    <div>
                        <label class="block text-[11px] font-black text-indigo-600 uppercase tracking-widest mb-2 ml-1">Category</label>
                        <select id="catInput" class="w-full p-4 bg-slate-50 border-2 border-transparent rounded-2xl outline-none cursor-pointer font-bold text-slate-700">
                            <option value="relationship">Relationships</option>
                            <option value="family">Family</option>
                            <option value="marriage">Marriage</option>
                            <option value="other" selected>Other</option>
                        </select>
                    </div>
                </div>

                <div class="relative">
                    <div class="flex justify-between mb-2 px-1">
                        <label class="block text-[11px] font-black text-indigo-600 uppercase tracking-widest">Your Confession</label>
                        <span id="charCount" class="text-[10px] font-bold text-slate-300 transition-colors">0 / 1000</span>
                    </div>
                    <textarea id="msgInput" rows="6" maxlength="1000" placeholder="Type your truth anonymously..." class="w-full p-6 bg-slate-50 border-2 border-transparent rounded-[32px] outline-none input-focus-effect leading-relaxed resize-none font-medium text-slate-700 text-lg"></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-4 bg-indigo-50/50 rounded-2xl border border-indigo-100 flex items-start gap-3">
                        <div class="relative flex items-center justify-center mt-1">
                            <div class="w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse-green"></div>
                        </div>
                        <div>
                            <p class="text-[10px] text-indigo-900 font-black uppercase tracking-widest mb-0.5">Privacy Shield Active</p>
                            <p class="text-[10px] text-indigo-600/80 font-bold leading-tight">No IP logging. 100% Anonymous.</p>
                        </div>
                    </div>
                    
                    <div id="redAlertNote" class="p-4 bg-white rounded-2xl border border-slate-100 flex items-start gap-3 transition-all">
                        <span class="text-sm">‚ö†Ô∏è</span>
                        <div>
                            <p class="text-[10px] text-slate-800 font-black uppercase tracking-widest mb-0.5">Safety Filter</p>
                            <p id="safetyText" class="text-[10px] text-slate-500 font-bold leading-tight">Social IDs & Abuse are blocked.</p>
                        </div>
                    </div>
                </div>

                <button id="submitBtn" type="submit" class="w-full bg-indigo-600 text-white py-5 rounded-[24px] font-black text-lg shadow-xl shadow-indigo-100 hover:bg-indigo-700 transition-all active:scale-95">Post Anonymously</button>
            </form>
        </div>
    </main>

    <footer id="mainFooter" class="bg-[#0f172a] text-slate-400 pt-16 pb-8 px-4 mt-20">
        <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-12">
            <div class="space-y-4 text-left">
                <h2 class="text-white text-xl font-black italic">Confess<span class="text-indigo-400">India</span></h2>
                <p class="text-sm leading-relaxed">The safest digital space for Indians worldwide to share their truths without judgment.</p>
                <div class="flex items-center gap-3 bg-slate-800/50 w-fit px-4 py-2 rounded-full border border-slate-700">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse-green"></div>
                    <span class="text-[10px] font-black uppercase tracking-widest text-slate-300">100% Anonymous</span>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-8 md:col-span-2 text-left">
                <div>
                    <h3 class="text-white text-xs font-black uppercase tracking-widest mb-6">Platform</h3>
                    <ul class="space-y-3 text-sm font-bold">
                        <li><a href="legal.html#mission" class="hover:text-white transition-colors">Our Mission</a></li>
                        <li><a href="legal.html#privacy" class="hover:text-white transition-colors">Privacy Policy</a></li>
                        <li><a href="legal.html#rules" class="hover:text-white transition-colors">Community Rules</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-white text-xs font-black uppercase tracking-widest mb-6">Connect</h3>
                    <ul class="space-y-3 text-sm font-bold">
                        <li><a href="support.html" class="hover:text-white transition-colors">Contact Support</a></li>
                        <li><a href="support.html?type=abuse" class="hover:text-red-400 transition-colors text-red-500/80">Report Abuse</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="max-w-4xl mx-auto mt-16 pt-8 border-t border-slate-800 text-center space-y-4">
            <p class="text-[10px] font-bold uppercase tracking-[0.2em] text-slate-500">No Cookies ‚Ä¢ No Emails ‚Ä¢ Just the Truth</p>
            <p class="text-[10px] text-slate-600 font-medium tracking-wider">¬© 2026 Confess India. Built for the brave and the unheard.</p>
        </div>
    </footer>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA8JIiJ5sRc5Fxy6qcYAXD8_nA8ELOBwkI", authDomain: "confession-india.firebaseapp.com", projectId: "confession-india", storageBucket: "confession-india.firebasestorage.app", messagingSenderId: "345080016810", appId: "1:345080016810:web:3032f570077ea8d6dd45d3" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const langMap = { en: "English", te: "Telugu", ta: "Tamil", kn: "Kannada", ml: "Malayalam", hi: "Hindi" };
        const userLang = localStorage.getItem('userLang') || 'en';
        document.getElementById('p-lang-tag').innerText = langMap[userLang] + " Feed";

        const msgInput = document.getElementById('msgInput');
        const userInput = document.getElementById('userInput');
        const catInput = document.getElementById('catInput');
        const redAlert = document.getElementById('redAlertNote');
        const charCount = document.getElementById('charCount');
        const safetyText = document.getElementById('safetyText');

        const PHONE_REGEX = /(\+?\d{1,4}[\s-]?)?(\d{10})|(\d{3}[\s-]?\d{3}[\s-]?\d{4})/;
        const SOCIAL_REGEX = /(@[A-Za-z0-9._]+)|(ig:|insta:|instagram:|tg:|telegram:)\s?[A-Za-z0-9._]+/i;
        const BAD_WORDS = ["fuck", "shit", "motherfucker", "bastard", "asshole", "bitch", "cunt", "dick", "maderchod", "mc", "behenchod", "bc", "bhenchod", "gand", "chutiya", "randi", "saala", "kamine", "lavde", "lanja", "munda", "kodaka", "dengu", "pooku", "sunni", "poolu", "punda", "baadu", "thevidiya", "bolimaga", "sule", "thayoli", "kunna", "pooru"];

        function containsBadWords(text) {
            if(!text) return false;
            const normalizedText = text.toLowerCase().replace(/[^a-z0-9]/g, '');
            return BAD_WORDS.some(word => normalizedText.includes(word.toLowerCase().replace(/[^a-z0-9]/g, '')));
        }

        function updateUI() {
            document.getElementById('p-msg').innerText = msgInput.value ? `"${msgInput.value}"` : "Your truth starts here...";
            document.getElementById('p-user').innerText = "BY " + (userInput.value.toUpperCase() || "ANONYMOUS");
            document.getElementById('p-cat').innerText = catInput.options[catInput.selectedIndex].text.toUpperCase();
            
            const len = msgInput.value.length;
            charCount.innerText = `${len} / 1000`;
            if (len >= 950) charCount.classList.add('limit-reached');
            else charCount.classList.remove('limit-reached');

            const currentText = msgInput.value.toLowerCase();
            const currentUser = userInput.value.toLowerCase();
            
            // Safety Check with UI text update
            if(PHONE_REGEX.test(currentText) || SOCIAL_REGEX.test(currentText) || containsBadWords(currentText) || containsBadWords(currentUser)) {
                redAlert.classList.add('shake-active');
                safetyText.innerText = "Conflict detected! Remove contact info/abuse.";
                safetyText.classList.add('text-red-500');
            } else {
                redAlert.classList.remove('shake-active');
                safetyText.innerText = "Social IDs & Abuse are blocked.";
                safetyText.classList.remove('text-red-500');
            }
        }

        [msgInput, userInput].forEach(el => el.addEventListener('input', updateUI));
        catInput.addEventListener('change', updateUI);

        document.getElementById('postForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const content = msgInput.value.trim();
            const username = userInput.value.trim();

            if(content.length < 10) return alert("Secret too short!");

            const isToxic = containsBadWords(username) || containsBadWords(content) || PHONE_REGEX.test(content) || SOCIAL_REGEX.test(content.toLowerCase());
            if (isToxic) {
                alert("üö´ Restricted language or contact info detected. Please edit to protect anonymity.");
                return;
            }

            const btn = document.getElementById('submitBtn');
            btn.disabled = true; btn.innerText = "Securing...";

            try {
                await db.collection('confessions').add({
                    username: username || "Anonymous",
                    category: catInput.value,
                    content: content,
                    language: userLang,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    supportCount: 0, 
                    meTooCount: 0,
                    status: "public"
                });
                document.getElementById('toast').classList.add('show');
                setTimeout(() => { window.location.href = 'index.html'; }, 2000);
            } catch (err) {
                btn.disabled = false; btn.innerText = "Post Anonymously";
                alert("Connection failed.");
            }
        });
    </script>
</body>
</html>
