<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LT5SF025XK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-LT5SF025XK');
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Share Your Secret - Confess India</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        #submitBtn:disabled { background-color: #94a3b8; cursor: not-allowed; transform: none !important; }
        .animate-pulse-green { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        
        #toast { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); z-index: 2000; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #toast.show { top: 20px; }
    </style>
</head>
<body class="bg-[#fdfdff] dark:bg-[#0b1120] font-sans text-slate-900 dark:text-slate-100 transition-colors duration-300 flex flex-col min-h-screen">

    <div id="toast">
        <div class="bg-indigo-600 text-white px-8 py-4 rounded-full shadow-2xl font-bold flex items-center gap-3">
            <span>‚ú®</span> Secret Sent Anonymously
        </div>
    </div>

    <div class="w-full bg-slate-900 py-1 border-b border-slate-800"></div>

    <header class="sticky top-0 z-[100] bg-white/80 dark:bg-[#0b1120]/80 backdrop-blur-xl border-b border-gray-100 dark:border-red-900/30">
        <div class="max-w-4xl mx-auto p-4 flex justify-between items-center">
            <div class="flex flex-col">
                <a href="index.html" class="hover:opacity-80 transition-opacity">
                    <h1 class="text-2xl font-black bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent leading-none">Confess India</h1>
                </a>
                <span class="text-[10px] text-gray-400 dark:text-slate-500 font-bold tracking-widest uppercase mt-1 ml-0.5">Share Your Truth</span>
            </div>
            <a href="index.html" class="bg-slate-50 dark:bg-slate-800 text-slate-500 px-5 py-2.5 rounded-2xl font-bold text-sm transition-all hover:bg-red-50 hover:text-red-500 border border-slate-100 dark:border-slate-700 uppercase text-[10px] tracking-widest">Cancel</a>
        </div>
    </header>

    <main class="max-w-2xl mx-auto px-6 py-10 flex-grow w-full">
        
        <div class="mb-10">
            <label class="text-[10px] font-black uppercase tracking-widest text-slate-400 dark:text-slate-500 ml-1 mb-2 block">Live Preview</label>
            <div id="previewContainer" class="p-8 bg-white dark:bg-[#1e293b] shadow-sm rounded-[32px] border border-slate-100 dark:border-slate-800 transition-all">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex flex-col">
                        <span id="p-cat" class="text-[10px] font-black uppercase text-indigo-500 mb-1">OTHER</span>
                        <div class="flex items-center gap-2">
                            <span id="p-user" class="text-[9px] text-slate-400 dark:text-slate-300 font-black uppercase tracking-widest">BY ANONYMOUS</span>
                            <span class="text-[15px] text-slate-300 leading-none">¬∑</span>
                            <span id="p-lang-tag" class="text-[9px] text-slate-300 dark:text-slate-500 font-bold uppercase tracking-widest">English Feed</span>
                        </div>
                    </div>
                </div>
                <p id="p-msg" class="text-slate-600 dark:text-slate-300 text-lg leading-relaxed font-medium mb-2 italic opacity-60">"Your truth starts here..."</p>
            </div>
        </div>

        <div class="bg-white dark:bg-[#1e293b] rounded-[32px] shadow-2xl shadow-slate-200/50 dark:shadow-none border border-slate-50 dark:border-slate-800 overflow-hidden">
            <form id="postForm" class="p-8 space-y-8">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-[11px] font-black text-indigo-600 dark:text-indigo-400 uppercase tracking-widest mb-2 ml-1">Pen Name</label>
                        <input type="text" id="userInput" placeholder="Silent Lion / Lioness" class="w-full p-4 bg-slate-50 dark:bg-slate-800/80 border-2 border-transparent dark:text-white rounded-2xl outline-none focus:border-indigo-500 transition-all font-bold text-slate-700" required>
                    </div>
                    <div>
                        <label class="block text-[11px] font-black text-indigo-600 dark:text-indigo-400 uppercase tracking-widest mb-2 ml-1">Category</label>
                        <select id="catInput" class="w-full p-4 bg-slate-50 dark:bg-slate-800/80 border-2 border-transparent dark:text-white rounded-2xl outline-none cursor-pointer font-bold text-slate-700">
                            <option value="relationship">Relationships</option>
                            <option value="family">Family</option>
                            <option value="marriage">Marriage</option>
                            <option value="other" selected>Other</option>
                        </select>
                    </div>
                </div>

                <div class="relative">
                    <div class="flex justify-between mb-2 px-1">
                        <label class="block text-[11px] font-black text-indigo-600 dark:text-indigo-400 uppercase tracking-widest">Your Confession</label>
                        <span id="charCount" class="text-[10px] font-bold text-slate-300 dark:text-slate-600 transition-colors">0 / 2000</span>
                    </div>
                    <textarea id="msgInput" rows="8" maxlength="2000" placeholder="Type your truth anonymously..." class="w-full p-6 bg-slate-50 dark:bg-slate-800/80 border-2 border-transparent dark:text-white rounded-[32px] outline-none focus:border-indigo-500 transition-all leading-relaxed resize-none font-medium text-slate-700 text-lg"></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="p-4 bg-indigo-50/50 dark:bg-indigo-900/10 rounded-2xl border border-indigo-100 dark:border-indigo-900/30 flex items-start gap-3">
                        <div class="w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse-green mt-1"></div>
                        <div>
                            <p class="text-[10px] text-indigo-900 dark:text-indigo-300 font-black uppercase tracking-widest mb-0.5">Privacy Shield Active</p>
                            <p class="text-[10px] text-indigo-600/80 dark:text-indigo-400/60 font-bold leading-tight">No IP logging. 100% Anonymous.</p>
                        </div>
                    </div>
                    <div id="redAlertNote" class="p-4 bg-white dark:bg-slate-800/50 rounded-2xl border border-slate-100 dark:border-slate-800 flex items-start gap-3 transition-all">
                        <span class="text-sm">‚ö†Ô∏è</span>
                        <div>
                            <p class="text-[10px] text-slate-800 dark:text-slate-200 font-black uppercase tracking-widest mb-0.5">Safety Filter</p>
                            <p id="safetyText" class="text-[10px] text-slate-500 dark:text-slate-500 font-bold leading-tight">Social IDs & Abuse are blocked.</p>
                        </div>
                    </div>
                </div>

                <button id="submitBtn" type="submit" class="w-full bg-indigo-600 text-white py-5 rounded-[24px] font-black text-lg shadow-xl shadow-indigo-100 dark:shadow-none hover:bg-indigo-700 transition-all active:scale-95">Post Anonymously</button>
            </form>
        </div>
    </main>

    <footer class="bg-[#0f172a] text-slate-400 pt-16 pb-8 px-4 mt-auto border-t border-slate-800">
        <div class="max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-12 text-left">
            <div class="space-y-4">
                <h2 class="text-white text-xl font-black italic">Confess<span class="text-indigo-400">India</span></h2>
                <p class="text-sm leading-relaxed">The safest digital space for Indians worldwide to share their truths.</p>
            </div>
            <div class="grid grid-cols-2 gap-8 md:col-span-2">
                <div>
                    <h3 class="text-white text-xs font-black uppercase tracking-widest mb-6">Platform</h3>
                    <ul class="space-y-3 text-sm font-bold">
                        <li><a href="legal.html#mission" class="hover:text-white transition-colors">Our Mission</a></li>
                        <li><a href="legal.html#privacy" class="hover:text-white transition-colors">Privacy Policy</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-white text-xs font-black uppercase tracking-widest mb-6">Connect</h3>
                    <ul class="space-y-3 text-sm font-bold">
                        <li><a href="support.html" class="hover:text-white transition-colors">Contact Support</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="max-w-4xl mx-auto mt-16 pt-8 border-t border-slate-800 text-center space-y-4">
            <div class="flex justify-center gap-4 text-slate-500 text-[10px] uppercase font-black tracking-widest">
                <span>üìç HYD: <span id="hyd-time">--:--</span></span>
                <span class="text-red-600">|</span>
                <span>üá¨üáß LDN: <span id="ldn-time">--:--</span></span>
            </div>
            <p class="text-[10px] text-slate-600 font-medium tracking-wider">¬© 2026 Confess India.</p>
        </div>
    </footer>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA8JIiJ5sRc5Fxy6qcYAXD8_nA8ELOBwkI", authDomain: "confession-india.firebaseapp.com", projectId: "confession-india", storageBucket: "confession-india.firebasestorage.app", messagingSenderId: "345080016810", appId: "1:345080016810:web:3032f570077ea8d6dd45d3" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const langMap = { en: "English", te: "Telugu", ta: "Tamil", kn: "Kannada", ml: "Malayalam", hi: "Hindi" };
        const userLang = localStorage.getItem('userLang') || 'en';
        document.getElementById('p-lang-tag').innerText = langMap[userLang] + " Feed";

        const msgInput = document.getElementById('msgInput');
        const userInput = document.getElementById('userInput');
        const catInput = document.getElementById('catInput');
        const redAlert = document.getElementById('redAlertNote');
        const charCount = document.getElementById('charCount');
        const safetyText = document.getElementById('safetyText');
        const submitBtn = document.getElementById('submitBtn');

        // Safety Assets
        const PHONE_REGEX = /(\+?\d{1,4}[\s-]?)?(\d{10})|(\d{3}[\s-]?\d{3}[\s-]?\d{4})/;
        const SOCIAL_REGEX = /(@[A-Za-z0-9._]+)|(ig:|insta:|instagram:|tg:|telegram:|snap:|snapchat:)\s?[A-Za-z0-9._]+/i;
        const BAD_WORDS = [
            "fuck", "shit", "motherfucker", "bastard", "asshole", "bitch", "cunt", "dick", "pussy", "slut", "whore",
            "maderchod", "mc", "behenchod", "bc", "bhenchod", "gand", "gandu", "chutiya", "randi", "saala", "kamine", "lavde", "bhadwa", "harami", "loduchand",
            "lanja", "munda", "kodaka", "dengu", "pooku", "sunni", "poolu", "lanjakodaka", "modda", "naayala", "neeyamma",
            "punda", "baadu", "thevidiya", "thayoli", "kunna", "pooru", "gommala", "omala", "otha", "moodu",
            "bolimaga", "sule", "nanmaga", "huchu", "gaanchali", "sulemaga",
            "fundi", "onnantha", "thayoli", "pandi", "koppa", "pula", "monesh", "nayintemon"
        ];

        function updateClocks() {
            const options = { hour: '2-digit', minute: '2-digit', hour12: true };
            try {
                document.getElementById('hyd-time').innerText = new Intl.DateTimeFormat('en-IN', { ...options, timeZone: 'Asia/Kolkata' }).format(new Date());
                document.getElementById('ldn-time').innerText = new Intl.DateTimeFormat('en-GB', { ...options, timeZone: 'Europe/London' }).format(new Date());
            } catch (e) {}
        }
        setInterval(updateClocks, 60000); updateClocks();

        function containsBadWords(text) {
            if(!text) return false;
            const cleanText = text.toLowerCase().replace(/[^a-z0-9]/g, '');
            return BAD_WORDS.some(word => {
                const cleanWord = word.toLowerCase().replace(/[^a-z0-9]/g, '');
                return cleanText.includes(cleanWord);
            });
        }

        function checkCooldown() {
            const lastPost = localStorage.getItem('lastPostTime');
            if (lastPost) {
                const diff = (Date.now() - parseInt(lastPost)) / 1000;
                if (diff < 60) {
                    submitBtn.disabled = true;
                    const timer = setInterval(() => {
                        const currentDiff = (Date.now() - parseInt(lastPost)) / 1000;
                        if (currentDiff >= 60) {
                            clearInterval(timer);
                            updateUI(); // Reset UI state
                        } else {
                            submitBtn.innerText = `Wait ${Math.ceil(60 - currentDiff)}s...`;
                        }
                    }, 1000);
                }
            }
        }

        function updateUI() {
            const content = msgInput.value;
            const user = userInput.value;
            
            document.getElementById('p-msg').innerText = content ? `"${content}"` : "Your truth starts here...";
            document.getElementById('p-user').innerText = "BY " + (user.toUpperCase() || "ANONYMOUS");
            document.getElementById('p-cat').innerText = catInput.options[catInput.selectedIndex].text.toUpperCase();
            charCount.innerText = `${content.length} / 2000`;

            const hasContact = PHONE_REGEX.test(content) || SOCIAL_REGEX.test(content.toLowerCase());
            const hasBad = containsBadWords(content) || containsBadWords(user);
            
            if(hasContact || hasBad) {
                safetyText.innerText = hasBad ? "Restricted language detected!" : "Contact info (Phone/Social) detected!";
                safetyText.classList.add('text-red-500');
                redAlert.classList.add('border-red-200', 'bg-red-50', 'dark:bg-red-900/10');
                submitBtn.disabled = true;
                submitBtn.innerText = "Post Anonymously";
            } else {
                safetyText.innerText = "Social IDs & Abuse are blocked.";
                safetyText.classList.remove('text-red-500');
                redAlert.classList.remove('border-red-200', 'bg-red-50', 'dark:bg-red-900/10');
                
                // Re-enable only if not in cooldown
                const lastPost = localStorage.getItem('lastPostTime');
                if (!lastPost || (Date.now() - parseInt(lastPost)) / 1000 >= 60) {
                    submitBtn.disabled = false;
                    submitBtn.innerText = "Post Anonymously";
                }
            }
        }

        [msgInput, userInput].forEach(el => el.addEventListener('input', updateUI));
        catInput.addEventListener('change', updateUI);
        checkCooldown();

        document.getElementById('postForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const content = msgInput.value.trim();
            const username = userInput.value.trim();
            const category = catInput.value;

            if(content.length < 10) return alert("Secret too short!");
            
            submitBtn.disabled = true; submitBtn.innerText = "Securing...";

            try {
                await db.collection('confessions').add({
                    username: username || "Anonymous",
                    category: category,
                    content: content,
                    language: userLang,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    supportCount: 0, meTooCount: 0, status: "public"
                });
                
                localStorage.setItem('lastPostTime', Date.now().toString());
                document.getElementById('toast').classList.add('show');
                setTimeout(() => { window.location.href = 'index.html'; }, 2000);
            } catch (err) {
                submitBtn.disabled = false; submitBtn.innerText = "Post Anonymously";
                alert("Connection failed.");
            }
        });
    </script>
</body>
</html>
